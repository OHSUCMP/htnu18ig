{
  "resourceType": "Library",
  "id": "library-OHSUHTNCommon",
  "extension": [ {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  } ],
  "url": "http://fhir.org/guides/ohsuhypertensionig/Library/OHSUHTNCommon",
  "version": "0.1",
  "name": "OHSUHTNCommon",
  "title": "Common Logic",
  "description": "Common logic spanning multiple interventions.",
  "content": [ {
    "contentType": "text/cql",
    "data": "bGlicmFyeSBPSFNVSFROQ29tbW9uIHZlcnNpb24gJzAuMScNCg0KdXNpbmcgRkhJUiB2ZXJzaW9uICc0LjAuMScNCg0KaW5jbHVkZSBGSElSSGVscGVycyB2ZXJzaW9uICc0LjAuMScgY2FsbGVkIEZISVJIZWxwZXJzDQoNCmNvZGVzeXN0ZW0gIkxPSU5DIjogJ2h0dHA6Ly9sb2luYy5vcmcnDQpjb2Rlc3lzdGVtICJTTk9NRUQiOiAnaHR0cDovL3Nub21lZC5pbmZvL3NjdCcNCmNvZGVzeXN0ZW0gIkNvbmRpdGlvbkNsaW5pY2FsU3RhdHVzQ29kZXMiOiAnaHR0cDovL3Rlcm1pbm9sb2d5LmhsNy5vcmcvQ29kZVN5c3RlbS9jb25kaXRpb24tY2xpbmljYWwnDQpjb2Rlc3lzdGVtICJDb25kaXRpb25WZXJpZmljYXRpb25TdGF0dXNDb2RlcyI6ICdodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL2NvbmRpdGlvbi12ZXItc3RhdHVzJw0KY29kZXN5c3RlbSAidjMgQ29kZSBTeXN0ZW0gQWN0Q29kZSI6ICdodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL3YzLUFjdENvZGUnDQpjb2Rlc3lzdGVtICJDb25kaXRpb25DYXRlZ29yeVN5c3RlbSI6ICdodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL2NvbmRpdGlvbi1jYXRlZ29yeScNCmNvZGVzeXN0ZW0gIk1lZGljYXRpb24gcmVxdWVzdCBzdGF0dXMiOiAnaHR0cDovL2hsNy5vcmcvZmhpci9Db2RlU3lzdGVtL21lZGljYXRpb25yZXF1ZXN0LXN0YXR1cycNCg0KdmFsdWVzZXQgIlN5c3RvbGljIGJsb29kIHByZXNzdXJlIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTEwNC4yJw0KdmFsdWVzZXQgIkRpYXN0b2xpYyBCbG9vZCBQcmVzc3VyZSI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM4ODMuMy41MjYuMi4xMDQ1Jw0KdmFsdWVzZXQgIkJsb29kIFByZXNzdXJlIE1lYXN1cmVkIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzg4My4zLjYwMC4yMDEyJw0KdmFsdWVzZXQgIkFtYnVsYXRvcnkgQmxvb2QgUHJlc3N1cmUgTW9uaXRvcmluZyAoQUJQTSkiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzNzYyLjEuNC4xMDQ3LjUxMScNCnZhbHVlc2V0ICJBbnRpaHlwZXJ0ZW5zaXZlIE1lZGljYXRpb25zIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTE3OC4xMCcNCg0KLyogUG9zc2libGUgZXhjbHVzaW9ucyBmcm9tIHdvcmtmbG93cyAqLw0KdmFsdWVzZXQgIkh5cGVydGVuc2lvbiI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM4ODMuMy4zMTU3LjQwMTInDQp2YWx1ZXNldCAiTm9uIGVzc2VudGlhbCBIeXBlcnRlbnNpb24gU05PTUVEQ1QiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzNzYyLjEuNC4xMDMyLjEwJw0KdmFsdWVzZXQgIlByZWduYW5jeSI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM4ODMuMy41MjYuMy4zNzgnDQp2YWx1ZXNldCAiRW5kIFN0YWdlIFJlbmFsIERpc2Vhc2UiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzODgzLjMuNTI2LjIuNTkwJw0KdmFsdWVzZXQgIkhvc3BpY2UgY2FyZSBhbWJ1bGF0b3J5IjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTEwOC4xNScNCg0KY29kZSAiYW1idWxhdG9yeSI6ICdBTUInIGZyb20gInYzIENvZGUgU3lzdGVtIEFjdENvZGUiIGRpc3BsYXkgJ2FtYnVsYXRvcnknDQoNCi8vIENvbmRpdGlvbiBDbGluaWNhbCBTdGF0dXMgQ29kZXMgLSBDb25zaWRlciB2YWx1ZSBzZXRzIGZvciB0aGVzZQ0KY29kZSAiYWN0aXZlIjogJ2FjdGl2ZScgZnJvbSAiQ29uZGl0aW9uQ2xpbmljYWxTdGF0dXNDb2RlcyINCmNvZGUgInJlY3VycmVuY2UiOiAncmVjdXJyZW5jZScgZnJvbSAiQ29uZGl0aW9uQ2xpbmljYWxTdGF0dXNDb2RlcyINCmNvZGUgInJlbGFwc2UiOiAncmVsYXBzZScgZnJvbSAiQ29uZGl0aW9uQ2xpbmljYWxTdGF0dXNDb2RlcyINCmNvZGUgImluYWN0aXZlIjogJ2luYWN0aXZlJyBmcm9tICJDb25kaXRpb25DbGluaWNhbFN0YXR1c0NvZGVzIg0KY29kZSAicmVtaXNzaW9uIjogJ3JlbWlzc2lvbicgZnJvbSAiQ29uZGl0aW9uQ2xpbmljYWxTdGF0dXNDb2RlcyINCmNvZGUgInJlc29sdmVkIjogJ3Jlc29sdmVkJyBmcm9tICJDb25kaXRpb25DbGluaWNhbFN0YXR1c0NvZGVzIg0KDQovLyBDb25kaXRpb24gVmVyaWZpY2F0aW9uIFN0YXR1cyBDb2RlcyAtIENvbnNpZGVyIHZhbHVlIHNldHMgZm9yIHRoZXNlDQpjb2RlICJ1bmNvbmZpcm1lZCI6ICd1bmNvbmZpcm1lZCcgZnJvbSBDb25kaXRpb25WZXJpZmljYXRpb25TdGF0dXNDb2Rlcw0KY29kZSAicHJvdmlzaW9uYWwiOiAncHJvdmlzaW9uYWwnIGZyb20gQ29uZGl0aW9uVmVyaWZpY2F0aW9uU3RhdHVzQ29kZXMNCmNvZGUgImRpZmZlcmVudGlhbCI6ICdkaWZmZXJlbnRpYWwnIGZyb20gQ29uZGl0aW9uVmVyaWZpY2F0aW9uU3RhdHVzQ29kZXMNCmNvZGUgImNvbmZpcm1lZCI6ICdjb25maXJtZWQnIGZyb20gQ29uZGl0aW9uVmVyaWZpY2F0aW9uU3RhdHVzQ29kZXMNCmNvZGUgInJlZnV0ZWQiOiAncmVmdXRlZCcgZnJvbSBDb25kaXRpb25WZXJpZmljYXRpb25TdGF0dXNDb2Rlcw0KY29kZSAiZW50ZXJlZC1pbi1lcnJvciI6ICdlbnRlcmVkLWluLWVycm9yJyBmcm9tIENvbmRpdGlvblZlcmlmaWNhdGlvblN0YXR1c0NvZGVzDQoNCmNvZGUgInByb2JsZW0tbGlzdC1pdGVtIjogJ3Byb2JsZW0tbGlzdC1pdGVtJyBmcm9tICJDb25kaXRpb25DYXRlZ29yeVN5c3RlbSIgZGlzcGxheSAnUHJvYmxlbSBMaXN0IEl0ZW0nDQpjb2RlICJlbmNvdW50ZXItZGlhZ25vc2lzIjogJ2VuY291bnRlci1kaWFnbm9zaXMnIGZyb20gIkNvbmRpdGlvbkNhdGVnb3J5U3lzdGVtIiBkaXNwbGF5ICdFbmNvdW50ZXIgRGlhZ25vc2lzJw0KDQpjb2RlICJob21lLW1lYXN1cmVtZW50IjogJzI2NDM2MjAwMycgZnJvbSAiU05PTUVEIg0KDQpjb2RlICJBY3RpdmUgTWVkaWNhdGlvbiBSZXF1ZXN0IjogJ2FjdGl2ZScgZnJvbSAiTWVkaWNhdGlvbiByZXF1ZXN0IHN0YXR1cyINCg0KY29udGV4dCBQYXRpZW50DQoNCmRlZmluZSBmdW5jdGlvbiAiQXZnIFN5c3RvbGljIEJQIihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOg0KICBBdmcobGlzdCBPDQogICAgcmV0dXJuIGFsbCBGSElSSGVscGVycy5Ub1F1YW50aXR5KHNpbmdsZXRvbiBmcm9tIChPLmNvbXBvbmVudCBDIHdoZXJlIEMuY29kZSBpbiAiU3lzdG9saWMgYmxvb2QgcHJlc3N1cmUiKS52YWx1ZSkNCiAgKQ0KDQpkZWZpbmUgZnVuY3Rpb24gIkF2ZyBEaWFzdG9saWMgQlAiKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6DQogIEF2ZyhsaXN0IE8NCiAgICByZXR1cm4gYWxsIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoc2luZ2xldG9uIGZyb20gKE8uY29tcG9uZW50IEMgd2hlcmUgQy5jb2RlIGluICJEaWFzdG9saWMgQmxvb2QgUHJlc3N1cmUiKS52YWx1ZSkNCiAgKQ0KDQpkZWZpbmUgZnVuY3Rpb24gIkF2ZyBCUCIobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToNCiAgVHVwbGUgeyBzeXN0b2xpYzogIkF2ZyBTeXN0b2xpYyBCUCIobGlzdCksIGRpYXN0b2xpYzogIkF2ZyBEaWFzdG9saWMgQlAiKGxpc3QpIH0NCg0KZGVmaW5lIGZ1bmN0aW9uICJBdmcgQlAgU3RyaW5nIihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOg0KICAoIkF2ZyBCUCIobGlzdCkpIE8NCiAgICByZXR1cm4gVG9TdHJpbmcoUm91bmQoTy5zeXN0b2xpYy52YWx1ZSkpICsgJy8nICsgVG9TdHJpbmcoUm91bmQoTy5kaWFzdG9saWMudmFsdWUpKSArICcgJyArIE8uc3lzdG9saWMudW5pdA0KDQpkZWZpbmUgZnVuY3Rpb24gIk5vcm1hbCBCUCIobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToNCiAgKCJBdmcgQlAiKGxpc3QpKSBPDQogICAgd2hlcmUgTy5zeXN0b2xpYy52YWx1ZSA8IDEzMA0KICAgIGFuZCBPLmRpYXN0b2xpYy52YWx1ZSA8IDgwDQoNCmRlZmluZSBmdW5jdGlvbiAiRWxldmF0ZWQgb3IgQWJvdmUgQlAiKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6DQogICgiQXZnIEJQIihsaXN0KSkgTw0KICAgIHdoZXJlIE8uc3lzdG9saWMudmFsdWUgPj0gMTMwDQogICAgb3IgTy5kaWFzdG9saWMudmFsdWUgPj0gODANCg0KZGVmaW5lIGZ1bmN0aW9uICJIVE4gU3RhZ2UgMSBCUCIobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToNCiAgKCJBdmcgQlAiKGxpc3QpKSBPDQogICAgd2hlcmUgKE8uc3lzdG9saWMudmFsdWUgPj0gMTMwIGFuZCBPLnN5c3RvbGljLnZhbHVlIDwgMTQwKQ0KICAgIG9yIChPLmRpYXN0b2xpYy52YWx1ZSA+PSA4MCBhbmQgTy5kaWFzdG9saWMudmFsdWUgPCA5MCkNCg0KZGVmaW5lIGZ1bmN0aW9uICJIVE4gU3RhZ2UgMiBCUCIobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToNCiAgKCJBdmcgQlAiKGxpc3QpKSBPDQogICAgd2hlcmUgTy5zeXN0b2xpYy52YWx1ZSA+PSAxNDANCiAgICBvciBPLmRpYXN0b2xpYy52YWx1ZSA+PSA5MA0KDQpkZWZpbmUgZnVuY3Rpb24gIkhUTiBTdGFnZSAyIEJQIFN5c3RvbGljIFNlY29uZCBUZXN0IihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOg0KICAoIkF2ZyBCUCIobGlzdCkpIE8NCiAgICB3aGVyZSBPLnN5c3RvbGljLnZhbHVlID49IDE2MA0KDQpkZWZpbmUgZnVuY3Rpb24gIkhUTiBDcmlzaXMgQlAiKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6DQogICgiQXZnIEJQIihsaXN0KSkgTw0KICAgIHdoZXJlIE8uc3lzdG9saWMudmFsdWUgPj0gMTgwDQogICAgb3IgTy5kaWFzdG9saWMudmFsdWUgPj0gMTIwDQoNCmRlZmluZSBmdW5jdGlvbiAiU3lzdG9saWMgQlAgVmFyaWFiaWxpdHkiKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6DQogIGlmIGxpc3QgaXMgbnVsbCB0aGVuDQogICAgbnVsbA0KICBlbHNlIGlmIENvdW50KGxpc3QpIDw9IDEgdGhlbg0KICAgIG51bGwNCiAgZWxzZQ0KICAgIFN0ZERldihsaXN0IE8NCiAgICAgIHJldHVybiBhbGwgRkhJUkhlbHBlcnMuVG9RdWFudGl0eShzaW5nbGV0b24gZnJvbSAoTy5jb21wb25lbnQgQyB3aGVyZSBDLmNvZGUgaW4gIlN5c3RvbGljIGJsb29kIHByZXNzdXJlIikudmFsdWUpDQogICkNCg0KZGVmaW5lIGZ1bmN0aW9uICJTeXN0b2xpYyBCUCBWYXJpYWJpbGl0eSBTdHJpbmciKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6DQogICgiU3lzdG9saWMgQlAgVmFyaWFiaWxpdHkiKGxpc3QpKSBTDQogICAgcmV0dXJuIFRvU3RyaW5nKFJvdW5kKFMudmFsdWUsIDEpKSArICcgJyArIFMudW5pdA0KDQoNCi8qIEhlbHBlcnMgKi8NCmRlZmluZSBmdW5jdGlvbiBXaXRoVW5pdChsaXN0IExpc3Q8T2JzZXJ2YXRpb24+LCBVbml0IFN0cmluZyk6DQogIGxpc3QgT2JzZXJ2YXRpb25zDQogICAgd2hlcmUgKA0KICAgICAgKChzaW5nbGV0b24gZnJvbSAoT2JzZXJ2YXRpb25zLmNvbXBvbmVudCBDIHdoZXJlIEMuY29kZSBpbiAiU3lzdG9saWMgYmxvb2QgcHJlc3N1cmUiKS52YWx1ZSBhcyBGSElSLlF1YW50aXR5KS51bml0LnZhbHVlIH4gVW5pdA0KICAgICAgICBhbmQgKHNpbmdsZXRvbiBmcm9tIChPYnNlcnZhdGlvbnMuY29tcG9uZW50IEMgd2hlcmUgQy5jb2RlIGluICJEaWFzdG9saWMgQmxvb2QgUHJlc3N1cmUiKS52YWx1ZSBhcyBGSElSLlF1YW50aXR5KS51bml0LnZhbHVlIH4gVW5pdCkNCiAgICAgIG9yICgoc2luZ2xldG9uIGZyb20gKE9ic2VydmF0aW9ucy5jb21wb25lbnQgQyB3aGVyZSBDLmNvZGUgaW4gIlN5c3RvbGljIGJsb29kIHByZXNzdXJlIikudmFsdWUgYXMgRkhJUi5RdWFudGl0eSkuY29kZS52YWx1ZSB+IFVuaXQNCiAgICAgICAgYW5kIChzaW5nbGV0b24gZnJvbSAoT2JzZXJ2YXRpb25zLmNvbXBvbmVudCBDIHdoZXJlIEMuY29kZSBpbiAiRGlhc3RvbGljIEJsb29kIFByZXNzdXJlIikudmFsdWUgYXMgRkhJUi5RdWFudGl0eSkuY29kZS52YWx1ZSB+IFVuaXQpDQogICAgKQ0KDQpkZWZpbmUgZnVuY3Rpb24gV2l0aFVuaXQodmFsdWUgUXVhbnRpdHksIFVuaXQgU3RyaW5nKToNCiAgKA0KICAgIHZhbHVlIHF1YW50aXR5DQogICAgd2hlcmUgKA0KICAgICAgcXVhbnRpdHkuY29kZS52YWx1ZSB+IFVuaXQNCiAgICAgIG9yIHF1YW50aXR5LnVuaXQudmFsdWUgfiBVbml0DQogICAgKQ0KICApIGlzIG5vdCBudWxsDQoNCg0KZGVmaW5lIGZ1bmN0aW9uIFF1YWxpZmllZEVuY291bnRlcihsaXN0IExpc3Q8RkhJUi5FbmNvdW50ZXI+KToNCiAgbGlzdCBFbmNvdW50ZXINCiAgICAvL3BsYW5uZWQgfCBhcnJpdmVkIHwgdHJpYWdlZCB8IGluLXByb2dyZXNzIHwgb25sZWF2ZSB8IGZpbmlzaGVkIHwgY2FuY2VsbGVkICsNCiAgICB3aGVyZSBFbmNvdW50ZXIuc3RhdHVzIH4gJ2ZpbmlzaGVkJw0KDQpkZWZpbmUgZnVuY3Rpb24gUXVhbGlmaWVkQ29uZGl0aW9uKGxpc3QgTGlzdDxGSElSLkNvbmRpdGlvbj4pOg0KICBsaXN0IENvbmRpdGlvbg0KICAgIC8vYWN0aXZlIHwgcmVjdXJyZW5jZSB8IHJlbGFwc2UgfCBpbmFjdGl2ZSB8IHJlbWlzc2lvbiB8IHJlc29sdmVkDQogICAgLy93aGVyZSBBY3RpdmVDb25kaXRpb24oQ29uZGl0aW9uKSBpcyBub3QgbnVsbA0KICAgIC8vdW5jb25maXJtZWQgfCBwcm92aXNpb25hbCB8IGRpZmZlcmVudGlhbCB8IGNvbmZpcm1lZCB8IHJlZnV0ZWQgfCBlbnRlcmVkLWluLWVycm9yDQogICAgd2hlcmUgQ29uZmlybWVkQ29uZGl0aW9uKENvbmRpdGlvbikgaXMgbm90IG51bGwNCg0KZGVmaW5lIGZ1bmN0aW9uIFF1YWxpZmllZE9ic2VydmF0aW9uKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6DQogIGxpc3QgT2JzZXJ2YXRpb24NCgkJd2hlcmUgKA0KICAgICAgLy9yZWdpc3RlcmVkIHwgcHJlbGltaW5hcnkgfCBmaW5hbCB8IGFtZW5kZWQgfCBjb3JyZWN0ZWQgfCBjYW5jZWxsZWQgfCBlbnRlcmVkLWluLWVycm9yIHwgdW5rbm93bg0KCQkJT2JzZXJ2YXRpb24uc3RhdHVzIH4gJ2ZpbmFsJw0KCQkJb3IgT2JzZXJ2YXRpb24uc3RhdHVzIH4gJ2FtZW5kZWQnDQoJCQlvciBPYnNlcnZhdGlvbi5zdGF0dXMgfiAnY29ycmVjdGVkJw0KCQkpDQoNCmRlZmluZSBmdW5jdGlvbiBRdWFsaWZpZWRQcm9jZWR1cmUobGlzdCBMaXN0PEZISVIuUHJvY2VkdXJlPik6DQogIGxpc3QgUHJvY2VkdXJlDQogICAgLy9wcmVwYXJhdGlvbiB8IGluLXByb2dyZXNzIHwgbm90LWRvbmUgfCBvbi1ob2xkIHwgc3RvcHBlZCB8IGNvbXBsZXRlZCB8IGVudGVyZWQtaW4tZXJyb3IgfCB1bmtub3duDQogICAgd2hlcmUgUHJvY2VkdXJlLnN0YXR1cyB+ICdjb21wbGV0ZWQnDQoNCmRlZmluZSBmdW5jdGlvbiBDb25maXJtZWRDb25kaXRpb24obGlzdCBMaXN0PENvbmRpdGlvbj4pOg0KICBsaXN0IENvbmRpdGlvbg0KICAgIHdoZXJlIEZISVJIZWxwZXJzLlRvQ29uY2VwdChDb25kaXRpb24udmVyaWZpY2F0aW9uU3RhdHVzKSB+ICJjb25maXJtZWQiDQoNCmRlZmluZSBmdW5jdGlvbiBDb25maXJtZWRDb25kaXRpb24odmFsdWUgQ29uZGl0aW9uKToNCiAgdmFsdWUgQ29uZGl0aW9uDQogICAgd2hlcmUgRkhJUkhlbHBlcnMuVG9Db25jZXB0KENvbmRpdGlvbi52ZXJpZmljYXRpb25TdGF0dXMpIH4gImNvbmZpcm1lZCINCg0KZGVmaW5lIGZ1bmN0aW9uIEFjdGl2ZUNvbmRpdGlvbihsaXN0IExpc3Q8Q29uZGl0aW9uPik6DQogIGxpc3QgQ29uZGl0aW9uDQogICAgd2hlcmUgRkhJUkhlbHBlcnMuVG9Db25jZXB0KENvbmRpdGlvbi5jbGluaWNhbFN0YXR1cykgfiAiYWN0aXZlIg0KICAgICAgYW5kIENvbmRpdGlvbi5hYmF0ZW1lbnQgaXMgbnVsbA0KDQpkZWZpbmUgZnVuY3Rpb24gQWN0aXZlQ29uZGl0aW9uKHZhbHVlIENvbmRpdGlvbik6DQogIHZhbHVlIENvbmRpdGlvbg0KICAgIHdoZXJlIEZISVJIZWxwZXJzLlRvQ29uY2VwdChDb25kaXRpb24uY2xpbmljYWxTdGF0dXMpIH4gImFjdGl2ZSINCiAgICAgIGFuZCBDb25kaXRpb24uYWJhdGVtZW50IGlzIG51bGwNCg0KZGVmaW5lIGZ1bmN0aW9uIEFjdGl2ZU9yUmVjdXJyaW5nKGxpc3QgTGlzdDxDb25kaXRpb24+KToNCiAgbGlzdCBDb25kaXRpb24NCiAgICB3aGVyZSAoDQogICAgICBGSElSSGVscGVycy5Ub0NvbmNlcHQoQ29uZGl0aW9uLmNsaW5pY2FsU3RhdHVzKSB+ICJhY3RpdmUiDQogICAgICAgIGFuZCBDb25kaXRpb24uYWJhdGVtZW50IGlzIG51bGwNCiAgICAgICkNCiAgICAgIG9yIEZISVJIZWxwZXJzLlRvQ29uY2VwdChDb25kaXRpb24uY2xpbmljYWxTdGF0dXMpIH4gInJlbGFwc2UiDQoNCi8vIEVwaWMgc29tZXRpbWVzIHByb3ZpZGVzIHRoZSBvaWQgaW5zdGVhZCBvZiB0aGUgbmFtZWQgc3lzdGVtLCBidXQgd2UgbmVlZCB0aGUgbmFtZWQgc3lzdGVtIGZvciBjb21wYXJpbmcgdG8gVmFsdWVTZXRzDQpkZWZpbmUgZnVuY3Rpb24gRml4RXBpY1N5c3RlbU1hcHBpbmcoc3lzdGVtIFN0cmluZyk6DQogIGlmIE1hdGNoZXMoc3lzdGVtLCAndXJuOm9pZDoyLjE2Ljg0MC4xLjExMzg4My42Ljk2JykgdGhlbiAnaHR0cDovL3Nub21lZC5pbmZvL3NjdCcNCiAgZWxzZSBpZiBNYXRjaGVzKHN5c3RlbSwgJ3VybjpvaWQ6Mi4xNi44NDAuMS4xMTM4ODMuNi45MCcpIHRoZW4gJ2h0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMC1jbScNCiAgZWxzZSBzeXN0ZW0NCg0KLy8gVGFrZSB0aGUgbGlzdCBvZiBDb2RlcyBhbmQgcmVwbGFjZSB0aGUgc3lzdGVtcyB3aGVuIG5lZWRlZA0KZGVmaW5lIGZ1bmN0aW9uIFRyYW5mb3JtQ29kZUxpc3QobGlzdCBMaXN0PFN5c3RlbS5Db2RlPik6DQogIGxpc3QgY29kaW5nDQogIHJldHVybiBTeXN0ZW0uQ29kZSB7DQogICAgY29kZTogY29kaW5nLmNvZGUsDQogICAgc3lzdGVtOiBGaXhFcGljU3lzdGVtTWFwcGluZyhjb2Rpbmcuc3lzdGVtKSwNCiAgICB2ZXJzaW9uOiBjb2RpbmcudmVyc2lvbiwNCiAgICBkaXNwbGF5OiBjb2RpbmcuZGlzcGxheQ0KICB9DQoNCi8vIFRyYW5zZm9ybSB0aGUgY29kZXMgaW4gdGhlIENvZGVhYmxlQ29uY2VwdCwgcmVwbGFjaW5nIHRoZSBzeXN0ZW1zIHdoZW4gbmVlZGVkDQpkZWZpbmUgZnVuY3Rpb24gVHJhbnNmb3JtQ29kZWFibGVDb25jZXB0KGNjIEZISVIuQ29kZWFibGVDb25jZXB0KToNCiAgVHJhbmZvcm1Db2RlTGlzdChGSElSSGVscGVycy5Ub0NvbmNlcHQoY2MpLmNvZGVzKQ0KDQpkZWZpbmUgZnVuY3Rpb24gUXVhbGlmaWVkR29hbChsaXN0IExpc3Q8R29hbD4pOg0KICBsaXN0IEdvYWwNCiAgICAvL3Byb3Bvc2VkIHwgcGxhbm5lZCB8IGFjY2VwdGVkIHwgYWN0aXZlIHwgb24taG9sZCB8IGNvbXBsZXRlZCB8IGNhbmNlbGxlZCB8IGVudGVyZWQtaW4tZXJyb3IgfCByZWplY3RlZA0KICAgIHdoZXJlICgNCiAgICAgIEdvYWwubGlmZWN5Y2xlU3RhdHVzIH4gJ3Byb3Bvc2VkJw0KICAgICAgb3IgR29hbC5saWZlY3ljbGVTdGF0dXMgfiAncGxhbm5lZCcNCiAgICAgIG9yIEdvYWwubGlmZWN5Y2xlU3RhdHVzIH4gJ2FjY2VwdGVkJw0KICAgICAgb3IgR29hbC5saWZlY3ljbGVTdGF0dXMgfiAnYWN0aXZlJw0KICAgICAgb3IgR29hbC5saWZlY3ljbGVTdGF0dXMgfiAnY29tcGxldGVkJw0KICAgICkNCg0KDQpkZWZpbmUgZnVuY3Rpb24gIkdldElkIih1cmkgU3RyaW5nKToNCglMYXN0KFNwbGl0KHVyaSwgJy8nKSkNCg0KLyoNCkBkZXNjcmlwdGlvbjogTm9ybWFsaXplcyBhIHZhbHVlIHRoYXQgaXMgYSBjaG9pY2Ugb2YgdGltaW5nLXZhbHVlZCB0eXBlcyB0byBhbiBlcXVpdmFsZW50IGludGVydmFsDQpAY29tbWVudDogTm9ybWFsaXplcyBhIGNob2ljZSB0eXBlIG9mIEZISVIuZGF0ZVRpbWUsIEZISVIuUGVyaW9kLCBGSElSLlRpbWluZywgRkhJUi5pbnN0YW5jZSwgRkhJUi5zdHJpbmcsIEZISVIuQWdlLCBvciBGSElSLlJhbmdlIHR5cGVzDQp0byBhbiBlcXVpdmFsZW50IGludGVydmFsLiBUaGlzIHNlbGVjdGlvbiBvZiBjaG9pY2UgdHlwZXMgaXMgYSBzdXBlcnNldCBvZiB0aGUgbWFqb3JpdHkgb2YgY2hvaWNlIHR5cGVzIHRoYXQgYXJlIHVzZWQgYXMgcG9zc2libGUNCnJlcHJlc2VudGF0aW9ucyBmb3IgdGltaW5nLXZhbHVlZCBlbGVtZW50cyBpbiBGSElSLCBhbGxvd2luZyB0aGlzIGZ1bmN0aW9uIHRvIGJlIHVzZWQgYWNyb3NzIGFueSByZXNvdXJjZS4gTk9URTogRHVlIHRvIHRoZQ0KY29tcGxleGl0eSBvZiBkZXRlcm1pbmluZyBhIHNpbmdsZSBpbnRlcnZhbCBmcm9tIGEgVGltaW5nIG9yIFN0cmluZyB0eXBlLCB0aGlzIGZ1bmN0aW9uIHdpbGwgdGhyb3cgYSBydW4tdGltZSBleGNlcHRpb24gaWYgaXQgaXMgdXNlZA0Kd2l0aCBhIFRpbWluZyBvciBTdHJpbmcuDQoqLw0KZGVmaW5lIGZ1bmN0aW9uICJOb3JtYWxpemUgSW50ZXJ2YWwiKGNob2ljZSBDaG9pY2U8RkhJUi5kYXRlVGltZSwgRkhJUi5QZXJpb2QsIEZISVIuVGltaW5nLCBGSElSLmluc3RhbnQsIEZISVIuc3RyaW5nLCBGSElSLkFnZSwgRkhJUi5SYW5nZT4pOg0KICBjYXNlDQoJICB3aGVuIGNob2ljZSBpcyBGSElSLmRhdGVUaW1lIHRoZW4NCiAgICAJSW50ZXJ2YWxbRkhJUkhlbHBlcnMuVG9EYXRlVGltZShjaG9pY2UgYXMgRkhJUi5kYXRlVGltZSksIEZISVJIZWxwZXJzLlRvRGF0ZVRpbWUoY2hvaWNlIGFzIEZISVIuZGF0ZVRpbWUpXQ0KCQl3aGVuIGNob2ljZSBpcyBGSElSLlBlcmlvZCB0aGVuDQogIAkJRkhJUkhlbHBlcnMuVG9JbnRlcnZhbChjaG9pY2UgYXMgRkhJUi5QZXJpb2QpDQoJCXdoZW4gY2hvaWNlIGlzIEZISVIuaW5zdGFudCB0aGVuDQoJCQlJbnRlcnZhbFtGSElSSGVscGVycy5Ub0RhdGVUaW1lKGNob2ljZSBhcyBGSElSLmluc3RhbnQpLCBGSElSSGVscGVycy5Ub0RhdGVUaW1lKGNob2ljZSBhcyBGSElSLmluc3RhbnQpXQ0KCQl3aGVuIGNob2ljZSBpcyBGSElSLkFnZSB0aGVuDQoJCSAgSW50ZXJ2YWxbRkhJUkhlbHBlcnMuVG9EYXRlKFBhdGllbnQuYmlydGhEYXRlKSArIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoY2hvaWNlIGFzIEZISVIuQWdlKSwNCgkJCSAgRkhJUkhlbHBlcnMuVG9EYXRlKFBhdGllbnQuYmlydGhEYXRlKSArIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoY2hvaWNlIGFzIEZISVIuQWdlKSArIDEgeWVhcikNCgkJd2hlbiBjaG9pY2UgaXMgRkhJUi5SYW5nZSB0aGVuDQoJCSAgSW50ZXJ2YWxbRkhJUkhlbHBlcnMuVG9EYXRlKFBhdGllbnQuYmlydGhEYXRlKSArIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoKGNob2ljZSBhcyBGSElSLlJhbmdlKS5sb3cpLA0KCQkJICBGSElSSGVscGVycy5Ub0RhdGUoUGF0aWVudC5iaXJ0aERhdGUpICsgRkhJUkhlbHBlcnMuVG9RdWFudGl0eSgoY2hvaWNlIGFzIEZISVIuUmFuZ2UpLmhpZ2gpICsgMSB5ZWFyKQ0KCQl3aGVuIGNob2ljZSBpcyBGSElSLlRpbWluZyB0aGVuDQoJCSAgTWVzc2FnZShudWxsIGFzIEludGVydmFsPERhdGVUaW1lPiwgdHJ1ZSwgJzEnLCAnRXJyb3InLCAnQ2Fubm90IGNvbXB1dGUgYSBzaW5nbGUgaW50ZXJ2YWwgZnJvbSBhIFRpbWluZyB0eXBlJykNCiAgICB3aGVuIGNob2ljZSBpcyBGSElSLnN0cmluZyB0aGVuDQogICAgICBNZXNzYWdlKG51bGwgYXMgSW50ZXJ2YWw8RGF0ZVRpbWU+LCB0cnVlLCAnMScsICdFcnJvcicsICdDYW5ub3QgY29tcHV0ZSBhbiBpbnRlcnZhbCBmcm9tIGEgU3RyaW5nIHZhbHVlJykNCgkJZWxzZQ0KCQkJbnVsbCBhcyBJbnRlcnZhbDxEYXRlVGltZT4NCgllbmQNCg0KLyoNCkBkZXNjcmlwdGlvbjogUmV0dXJucyBhbiBpbnRlcnZhbCByZXByZXNlbnRpbmcgdGhlIG5vcm1hbGl6ZWQgQWJhdGVtZW50IG9mIGEgZ2l2ZW4gQ29uZGl0aW9uIHJlc291cmNlLg0KQGNvbW1lbnQ6IE5PVEU6IER1ZSB0byB0aGUgY29tcGxleGl0eSBvZiBkZXRlcm1pbmluZyBhbiBpbnRlcnZhbCBmcm9tIGEgU3RyaW5nLCB0aGlzIGZ1bmN0aW9uIHdpbGwgdGhyb3cNCmEgcnVuLXRpbWUgZXhjZXB0aW9uIGlmIHVzZWQgd2l0aCBhIENvbmRpdGlvbiBpbnN0YW5jZSB0aGF0IGhhcyBhIFN0cmluZyBhcyB0aGUgYWJhdGVtZW50IHZhbHVlLg0KKi8NCmRlZmluZSBmdW5jdGlvbiAiTm9ybWFsaXplIEFiYXRlbWVudCIoY29uZGl0aW9uIENvbmRpdGlvbik6DQogIGlmIGNvbmRpdGlvbi5hYmF0ZW1lbnQgaXMgRkhJUi5kYXRlVGltZSB0aGVuDQogICAgSW50ZXJ2YWxbRkhJUkhlbHBlcnMuVG9EYXRlVGltZShjb25kaXRpb24uYWJhdGVtZW50IGFzIEZISVIuZGF0ZVRpbWUpLCBGSElSSGVscGVycy5Ub0RhdGVUaW1lKGNvbmRpdGlvbi5hYmF0ZW1lbnQgYXMgRkhJUi5kYXRlVGltZSldDQogIGVsc2UgaWYgY29uZGl0aW9uLmFiYXRlbWVudCBpcyBGSElSLlBlcmlvZCB0aGVuDQogICAgRkhJUkhlbHBlcnMuVG9JbnRlcnZhbChjb25kaXRpb24uYWJhdGVtZW50IGFzIEZISVIuUGVyaW9kKQ0KICBlbHNlIGlmIGNvbmRpdGlvbi5hYmF0ZW1lbnQgaXMgRkhJUi5zdHJpbmcgdGhlbg0KICAgIE1lc3NhZ2UobnVsbCBhcyBJbnRlcnZhbDxEYXRlVGltZT4sIHRydWUsICcxJywgJ0Vycm9yJywgJ0Nhbm5vdCBjb21wdXRlIGFuIGludGVydmFsIGZyb20gYSBTdHJpbmcgdmFsdWUnKQ0KICBlbHNlIGlmIGNvbmRpdGlvbi5hYmF0ZW1lbnQgaXMgRkhJUi5BZ2UgdGhlbg0KICAgIEludGVydmFsW0ZISVJIZWxwZXJzLlRvRGF0ZShQYXRpZW50LmJpcnRoRGF0ZSkgKyBGSElSSGVscGVycy5Ub1F1YW50aXR5KGNvbmRpdGlvbi5hYmF0ZW1lbnQgYXMgRkhJUi5BZ2UpLA0KICAgICAgRkhJUkhlbHBlcnMuVG9EYXRlKFBhdGllbnQuYmlydGhEYXRlKSArIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoY29uZGl0aW9uLmFiYXRlbWVudCBhcyBGSElSLkFnZSkgKyAxIHllYXIpDQogIGVsc2UgaWYgY29uZGl0aW9uLmFiYXRlbWVudCBpcyBGSElSLlJhbmdlIHRoZW4NCiAgICBJbnRlcnZhbFtGSElSSGVscGVycy5Ub0RhdGUoUGF0aWVudC5iaXJ0aERhdGUpICsgRkhJUkhlbHBlcnMuVG9RdWFudGl0eSgoY29uZGl0aW9uLmFiYXRlbWVudCBhcyBGSElSLlJhbmdlKS5sb3cpLA0KICAgICAgRkhJUkhlbHBlcnMuVG9EYXRlKFBhdGllbnQuYmlydGhEYXRlKSArIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoKGNvbmRpdGlvbi5hYmF0ZW1lbnQgYXMgRkhJUi5SYW5nZSkuaGlnaCkgKyAxIHllYXIpDQogIGVsc2UgaWYgY29uZGl0aW9uLmFiYXRlbWVudCBpcyBGSElSLmJvb2xlYW4gdGhlbg0KICAgIEludGVydmFsW2VuZCBvZiAiTm9ybWFsaXplIEludGVydmFsIihjb25kaXRpb24ub25zZXQpLCBjb25kaXRpb24ucmVjb3JkZWREYXRlKQ0KICBlbHNlIG51bGwNCg0KLyoNCkBkZXNjcmlwdGlvbjogUmV0dXJucyBhbiBpbnRlcnZhbCByZXByZXNlbnRpbmcgdGhlIG5vcm1hbGl6ZWQgcHJldmFsZW5jZSBwZXJpb2Qgb2YgYSBnaXZlbiBDb25kaXRpb24gcmVzb3VyY2UuDQoqLw0KZGVmaW5lIGZ1bmN0aW9uICJQcmV2YWxlbmNlIFBlcmlvZCIoY29uZGl0aW9uIENvbmRpdGlvbik6DQogIGlmIGNvbmRpdGlvbi5jbGluaWNhbFN0YXR1cyB+ICJhY3RpdmUiDQogICAgb3IgY29uZGl0aW9uLmNsaW5pY2FsU3RhdHVzIH4gInJlY3VycmVuY2UiDQogICAgb3IgY29uZGl0aW9uLmNsaW5pY2FsU3RhdHVzIH4gInJlbGFwc2UiDQogICAgLy8gVGhpcyBwcmV2ZW50cyBlcnJvcnMgd2hlbiBhIGNvbmRpdGlvbiBoYXMgYW4gb25zZXQgYW5kIGFiYXRlbWVudCBvbiB0aGUgc2FtZSBkYXkgYW5kIG5vIHRpbWVzdGFtcCBpcyBwcm92aWRlZCAoRXBpYykNCiAgICBvciBlbmQgb2YgIk5vcm1hbGl6ZSBBYmF0ZW1lbnQiKGNvbmRpdGlvbikgaXMgbm90IG51bGwgdGhlbg0KICAgIEludGVydmFsW3N0YXJ0IG9mICJOb3JtYWxpemUgSW50ZXJ2YWwiKGNvbmRpdGlvbi5vbnNldCksIGVuZCBvZiAiTm9ybWFsaXplIEFiYXRlbWVudCIoY29uZGl0aW9uKV0NCiAgZWxzZQ0KICAgIC8vIFRoZSBjb25kaXRpb24gaXMgbm90IGFjdGl2ZSBidXQgaGFzIG5vIGFiYXRlbWVudCBkYXRlLCBzbyB3ZSBjYW4ndCBzYXkgd2hlbiBpdCBlbmRlZA0KICAgIEludGVydmFsW3N0YXJ0IG9mICJOb3JtYWxpemUgSW50ZXJ2YWwiKGNvbmRpdGlvbi5vbnNldCksIG51bGwpDQoNCi8qKioqKiBDb21tb24gRGF0YSAqKioqKi8NCg0KLyogUG90ZW50aWFsIEV4Y2x1c2lvbiBDcml0ZXJpYSAqLw0KZGVmaW5lICJQYXRpZW50IFVuZGVyIEFnZSAxOCI6DQogIEFnZUluWWVhcnNBdChUb2RheSgpKSA8IDE4DQoNCmRlZmluZSAiUGF0aWVudCBPdmVyIEFnZSA4MCI6DQogIEFnZUluWWVhcnNBdChUb2RheSgpKSA+IDgwDQoNCi8vIEdyYWIgYWxsIGNvbmRpdGlvbnMgZm9yIHBhdGllbnRzIHNpbmNlIHdlIGNhbid0IGxpbWl0IGJ5IGNvZGUgaW4gRXBpYy4NCmRlZmluZSAiQ29uZGl0aW9ucyI6DQogIChRdWFsaWZpZWRDb25kaXRpb24oWyJDb25kaXRpb24iOiBjYXRlZ29yeSB+ICJwcm9ibGVtLWxpc3QtaXRlbSJdKSkgdW5pb24NCiAgKFF1YWxpZmllZENvbmRpdGlvbihbIkNvbmRpdGlvbiI6IGNhdGVnb3J5IH4gImVuY291bnRlci1kaWFnbm9zaXMiXSkpDQoNCmRlZmluZSAiQ29uZGl0aW9uIEluZGljYXRpbmcgRW5kIFN0YWdlIFJlbmFsIERpc2Vhc2UiOg0KICAiQ29uZGl0aW9ucyIgUHJvYmxlbQ0KICAgIHdoZXJlIFRyYW5zZm9ybUNvZGVhYmxlQ29uY2VwdChQcm9ibGVtLmNvZGUpIGluICJFbmQgU3RhZ2UgUmVuYWwgRGlzZWFzZSIgYW5kIGVuZCBvZiAiUHJldmFsZW5jZSBQZXJpb2QiKFByb2JsZW0pID49IFRvZGF5KCkNCg0KZGVmaW5lICJDb25kaXRpb24gSW5kaWNhdGluZyBQcmVnbmFuY3kiOg0KICAiQ29uZGl0aW9ucyIgUHJvYmxlbQ0KICAgIHdoZXJlIFRyYW5zZm9ybUNvZGVhYmxlQ29uY2VwdChQcm9ibGVtLmNvZGUpIGluICJQcmVnbmFuY3kiIGFuZCBlbmQgb2YgIlByZXZhbGVuY2UgUGVyaW9kIihQcm9ibGVtKSA+PSBUb2RheSgpDQoNCmRlZmluZSAiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIjoNCiAgKFdpdGhVbml0KFF1YWxpZmllZE9ic2VydmF0aW9uKFsiT2JzZXJ2YXRpb24iOiAiQmxvb2QgUHJlc3N1cmUgTWVhc3VyZWQiXSksICdtbVtIZ10nKSkgTw0KICAgICAgc29ydCBieSBDb2FsZXNjZShzdGFydCBvZiAiTm9ybWFsaXplIEludGVydmFsIihlZmZlY3RpdmUpLCBpc3N1ZWQpDQoNCmRlZmluZSAiTW9zdCBSZWNlbnQgQlAgUmVhZGluZyI6DQogIExhc3QoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyIgTyBzb3J0IGJ5IENvYWxlc2NlKHN0YXJ0IG9mICJOb3JtYWxpemUgSW50ZXJ2YWwiKGVmZmVjdGl2ZSksIGlzc3VlZCkpDQoNCmRlZmluZSAiQlAgV2l0aGluIDE0IGRheXMiOg0KICAiTW9zdCBSZWNlbnQgQlAgUmVhZGluZyIgQlANCiAgcmV0dXJuIENvYWxlc2NlKHN0YXJ0IG9mICJOb3JtYWxpemUgSW50ZXJ2YWwiKEJQLmVmZmVjdGl2ZSksIEJQLmlzc3VlZCkgKyAxNCBkYXlzID49IFRvZGF5KCkNCg0KZGVmaW5lICJIVE4gQ3Jpc2lzIjoNCiAgIkJQIFdpdGhpbiAxNCBkYXlzIiBhbmQgIkhUTiBDcmlzaXMgQlAiKHsgIk1vc3QgUmVjZW50IEJQIFJlYWRpbmciIH0pIGlzIG5vdCBudWxsDQoNCmRlZmluZSAiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMiOg0KICAiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIiBCUCB3aGVyZSAiTm9ybWFsaXplIEludGVydmFsIihCUC5lZmZlY3RpdmUpIHN0YXJ0cyAyNCBtb250aHMgb3IgbGVzcyBiZWZvcmUgVG9kYXkoKQ0KICAgIHNvcnQgYnkgQ29hbGVzY2Uoc3RhcnQgb2YgIk5vcm1hbGl6ZSBJbnRlcnZhbCIoZWZmZWN0aXZlKSwgaXNzdWVkKQ0KDQpkZWZpbmUgIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIERlc2NlbmRpbmciOg0KICAiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMiIE8gc29ydCBieSBDb2FsZXNjZShzdGFydCBvZiAiTm9ybWFsaXplIEludGVydmFsIihlZmZlY3RpdmUpLCBpc3N1ZWQpIGRlc2MNCg0KZGVmaW5lIGZ1bmN0aW9uIE1lYXN1cmVtZW50U2V0dGluZ3MobGlzdCBMaXN0PEV4dGVuc2lvbj4pOg0KICBsaXN0IEV4dGVuc2lvbg0KICAgIHdoZXJlIEV4dGVuc2lvbi51cmwgPSAnaHR0cDovL2hsNy5vcmcvZmhpci91cy92aXRhbHMvU3RydWN0dXJlRGVmaW5pdGlvbi9NZWFzdXJlbWVudFNldHRpbmdFeHQnDQogIHJldHVybiBGSElSSGVscGVycy5Ub0NvZGUoRXh0ZW5zaW9uLnZhbHVlKQ0KDQpkZWZpbmUgIkhvbWUgQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIjoNCiAgIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIiBCUE9ic2VydmF0aW9uDQogICAgd2hlcmUgIk1lYXN1cmVtZW50U2V0dGluZ3MiKEJQT2JzZXJ2YXRpb24uZXh0ZW5zaW9uKSBjb250YWlucyAiaG9tZS1tZWFzdXJlbWVudCINCg0KZGVmaW5lICJPZmZpY2UgQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIjoNCiAgIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIiBleGNlcHQgIkhvbWUgQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIg0KDQovLyBSZXZpc2l0IGxvZ2ljIHdoZW4gcmVhZHkgdG8gYWRkcmVzcyBhbWJ1bGF0b3J5IG9ic2VydmF0aW9ucy4gQ2hlY2sgb3V0IGNvbW1pdCA1NzA0NjQ0OGEyNGQyNGE3NjdkNDAyZTVmYThhOTY3NzlhNDg4ZjAyIGZvciBvbGQgbG9naWMNCmRlZmluZSAiQW1idWxhdG9yeSBCbG9vZCBQcmVzc3VyZSBNb25pdG9yaW5nIE9ic2VydmF0aW9ucyI6DQogIHt9DQoNCmRlZmluZSAiSGFzIEJQIFNldCI6DQogICAgaWYgbm90IGV4aXN0cyAiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMiIHRoZW4gZmFsc2UNCiAgICBlbHNlIGNhbGN1bGF0ZVNjb3JlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyIpID49IDQNCg0KZGVmaW5lIGZ1bmN0aW9uIHNjb3JlKG9ic2VydmF0aW9uIE9ic2VydmF0aW9uKToNCiAgaWYgb2JzZXJ2YXRpb24gaW4gIkFtYnVsYXRvcnkgQmxvb2QgUHJlc3N1cmUgTW9uaXRvcmluZyBPYnNlcnZhdGlvbnMiIHRoZW4gMC4zMzMNCiAgZWxzZSBpZiBvYnNlcnZhdGlvbiBpbiAiSG9tZSBCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMiIHRoZW4gMC42NjcNCiAgZWxzZSAxDQoNCmRlZmluZSBmdW5jdGlvbiBjYWxjdWxhdGVTY29yZShsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOg0KICBTdW0obGlzdCBPDQogICAgcmV0dXJuIGFsbCBzY29yZShPKQ0KICApDQoNCmRlZmluZSAiTW9zdCBSZWNlbnQgQlAgU2V0IjoNCiAgaWYgbm90ICJIYXMgQlAgU2V0IiB0aGVuIG51bGwNCiAgZWxzZSBpZiBjYWxjdWxhdGVTY29yZShUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNCkpID49IDQgdGhlbiBUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNCkNCiAgZWxzZSBpZiBjYWxjdWxhdGVTY29yZShUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNSkpID49IDQgdGhlbiBUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNSkNCiAgZWxzZSBpZiBjYWxjdWxhdGVTY29yZShUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNikpID49IDQgdGhlbiBUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNikNCiAgZWxzZSBpZiBjYWxjdWxhdGVTY29yZShUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNykpID49IDQgdGhlbiBUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNykNCiAgZWxzZSBpZiBjYWxjdWxhdGVTY29yZShUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgOCkpID49IDQgdGhlbiBUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgOCkNCiAgZWxzZSBpZiBjYWxjdWxhdGVTY29yZShUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgOSkpID49IDQgdGhlbiBUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgOSkNCiAgZWxzZSBpZiBjYWxjdWxhdGVTY29yZShUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgMTApKSA+PSA0IHRoZW4gVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDEwKQ0KICBlbHNlIGlmIGNhbGN1bGF0ZVNjb3JlKFRha2UoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIERlc2NlbmRpbmciLCAxMSkpID49IDQgdGhlbiBUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgMTEpDQogIGVsc2UgaWYgY2FsY3VsYXRlU2NvcmUoVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDEyKSkgPj0gNCB0aGVuIFRha2UoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIERlc2NlbmRpbmciLCAxMikNCiAgZWxzZSBudWxsDQoNCmRlZmluZSAiQXZlcmFnZSBBbGwgQlAgTGFzdCAyIFllYXJzIjoNCiAgIkF2ZyBCUCIoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIikNCg0KZGVmaW5lICJBdmVyYWdlIE1vc3QgUmVjZW50IEJQIFNldCI6DQogICJBdmcgQlAiKCJNb3N0IFJlY2VudCBCUCBTZXQiKQ0KDQovLyBJcyBsYXN0IEJQIHNldCBvciBhbGwgQlBzIGF2Z2UgPiAxMzAvODA/DQpkZWZpbmUgIlBhdGllbnQgSGFzIFBvdGVudGlhbCBIVE4gU3RhZ2UgMSBCUCI6DQogICgNCiAgICAiSFROIFN0YWdlIDEgQlAiKCJNb3N0IFJlY2VudCBCUCBTZXQiKSBpcyBub3QgbnVsbA0KICAgIG9yICJIVE4gU3RhZ2UgMSBCUCIoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIikgaXMgbm90IG51bGwNCiAgKQ0KDQovLyBJcyBsYXN0IEJQIHNldCBvciBhbGwgQlBzIGF2ZXJhZ2UgPiAxNDAgU0JQIG9yID4gOTAgREJQPw0KZGVmaW5lICJQYXRpZW50IEhhcyBQb3RlbnRpYWwgSFROIFN0YWdlIDIgQlAiOg0KICAoDQogICAgIkhUTiBTdGFnZSAyIEJQIigiTW9zdCBSZWNlbnQgQlAgU2V0IikgaXMgbm90IG51bGwNCiAgICBvciAiSFROIFN0YWdlIDIgQlAiKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyIpIGlzIG5vdCBudWxsDQogICkNCg0KLy8gSXMgU0JQIENvZWZmIG9mIFZhciA+IDExIGZvciBhbGwgQlBzIGFuZCBubyBBQlBNPw0KZGVmaW5lICJCUCBIaWdobHkgVmFyaWFibGUiOg0KICBpZiAiSGFzIEJQIFNldCIgdGhlbg0KICAgICgNCiAgICAgICJTeXN0b2xpYyBCUCBWYXJpYWJpbGl0eSIoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIikudmFsdWUgPiAxMQ0KICAgICAgLy8gVGhpcyBsb2dpYyB3YXMgcmVtb3ZlZA0KICAgICAgLy9hbmQgbm90IGV4aXN0cyAiQW1idWxhdG9yeSBCbG9vZCBQcmVzc3VyZSBNb25pdG9yaW5nIFByb2NlZHVyZXMiDQogICAgKQ0KICBlbHNlIG51bGwNCg0KZGVmaW5lICJDb25kaXRpb24gSW5kaWNhdGluZyBQcmVleGlzdGluZyBIeXBlcnRlbnNpb24iOg0KICAiQ29uZGl0aW9ucyIgUHJvYmxlbQ0KICAgIHdoZXJlIChUcmFuc2Zvcm1Db2RlYWJsZUNvbmNlcHQoUHJvYmxlbS5jb2RlKSBpbiAiSHlwZXJ0ZW5zaW9uIiBvciBUcmFuc2Zvcm1Db2RlYWJsZUNvbmNlcHQoUHJvYmxlbS5jb2RlKSBpbiAiTm9uIGVzc2VudGlhbCBIeXBlcnRlbnNpb24gU05PTUVEQ1QiKSBhbmQgZW5kIG9mICJQcmV2YWxlbmNlIFBlcmlvZCIoUHJvYmxlbSkgPj0gVG9kYXkoKQ0KDQovLyBEb2VzIHBhdGllbnQgaGF2ZSBhIEJQIGdvYWw/DQpkZWZpbmUgIlF1YWxpZnlpbmcgQmxvb2QgUHJlc3N1cmUgR29hbHMiOg0KICAoUXVhbGlmaWVkR29hbChbIkdvYWwiXSkpIEJQR29hbA0KICAgIHdoZXJlICgNCiAgICAgIHNpbmdsZXRvbiBmcm9tIChCUEdvYWwudGFyZ2V0IFN5c3RvbGljDQogICAgICAgIHdoZXJlIFN5c3RvbGljLm1lYXN1cmUgaW4gIlN5c3RvbGljIGJsb29kIHByZXNzdXJlIg0KICAgICAgICAgIGFuZCBTeXN0b2xpYy5kZXRhaWwgaXMgUXVhbnRpdHkNCiAgICAgICAgICBhbmQgV2l0aFVuaXQoU3lzdG9saWMuZGV0YWlsLCAnbW1bSGddJykpDQogICAgKSBTeXN0b2xpY1RhcmdldCBpcyBub3QgbnVsbA0KICAgICAgYW5kICgNCiAgICAgICAgc2luZ2xldG9uIGZyb20gKEJQR29hbC50YXJnZXQgRGlhc3RvbGljDQogICAgICAgICAgd2hlcmUgRGlhc3RvbGljLm1lYXN1cmUgaW4gIkRpYXN0b2xpYyBCbG9vZCBQcmVzc3VyZSINCiAgICAgICAgICAgIGFuZCBEaWFzdG9saWMuZGV0YWlsIGlzIFF1YW50aXR5DQogICAgICAgICAgICBhbmQgV2l0aFVuaXQoRGlhc3RvbGljLmRldGFpbCwgJ21tW0hnXScpKQ0KICAgICAgKSBEaWFzdG9saWNUYXJnZXQgaXMgbm90IG51bGwNCg0KZGVmaW5lICJNb3N0IFJlY2VudGx5IEVzdGFibGlzaGVkIEJsb29kIFByZXNzdXJlIEdvYWwiOg0KICBMYXN0ICgNCiAgICAiUXVhbGlmeWluZyBCbG9vZCBQcmVzc3VyZSBHb2FscyIgQlBHb2FsDQogICAgICBzb3J0IGJ5IChzdGFydCBhcyBkYXRlKQ0KICApDQoNCmRlZmluZSAiUGF0aWVudCBoYXMgYSBCUCBHb2FsIjoNCiAgZXhpc3RzICJRdWFsaWZ5aW5nIEJsb29kIFByZXNzdXJlIEdvYWxzIg0KDQoNCmRlZmluZSAiQlAgZnJvbSBNb3N0IFJlY2VudCBHb2FsIjoNCiAgIk1vc3QgUmVjZW50bHkgRXN0YWJsaXNoZWQgQmxvb2QgUHJlc3N1cmUgR29hbCIgQlBHb2FsDQogICAgcmV0dXJuIFR1cGxlIHsNCiAgICAgIHN5c3RvbGljOiBzaW5nbGV0b24gZnJvbSAoQlBHb2FsLnRhcmdldCBTeXN0b2xpYyB3aGVyZSBTeXN0b2xpYy5tZWFzdXJlIGluICJTeXN0b2xpYyBibG9vZCBwcmVzc3VyZSIpLmRldGFpbCBhcyBRdWFudGl0eSwNCiAgICAgIGRpYXN0b2xpYzogc2luZ2xldG9uIGZyb20gKEJQR29hbC50YXJnZXQgRGlhc3RvbGljIHdoZXJlIERpYXN0b2xpYy5tZWFzdXJlIGluICJEaWFzdG9saWMgQmxvb2QgUHJlc3N1cmUiKS5kZXRhaWwgYXMgUXVhbnRpdHkNCiAgICB9DQoNCmRlZmluZSAiQWJvdmUgR29hbCBBdmVyYWdlIE1vc3QgUmVjZW50IjoNCiAgIkF2ZXJhZ2UgTW9zdCBSZWNlbnQgQlAgU2V0Ii5zeXN0b2xpYyA+ICJCUCBmcm9tIE1vc3QgUmVjZW50IEdvYWwiLnN5c3RvbGljIG9yDQogICJBdmVyYWdlIE1vc3QgUmVjZW50IEJQIFNldCIuZGlhc3RvbGljID4gIkJQIGZyb20gTW9zdCBSZWNlbnQgR29hbCIuZGlhc3RvbGljDQoNCmRlZmluZSAiQlAgR29hbCBNZXQiOg0KICAiUGF0aWVudCBoYXMgYSBCUCBHb2FsIiBhbmQgIkhhcyBCUCBTZXQiIGFuZCBub3QgIkFib3ZlIEdvYWwgQXZlcmFnZSBNb3N0IFJlY2VudCINCiAgYW5kIG5vdCAiQlAgSGlnaGx5IFZhcmlhYmxlIg0KDQpkZWZpbmUgIkdvYWwgSW50ZXJ2YWwiOg0KICBJbnRlcnZhbFsoIk1vc3QgUmVjZW50bHkgRXN0YWJsaXNoZWQgQmxvb2QgUHJlc3N1cmUgR29hbCIuc3RhcnQgYXMgZGF0ZSksDQogICAgKCJNb3N0IFJlY2VudGx5IEVzdGFibGlzaGVkIEJsb29kIFByZXNzdXJlIEdvYWwiLnN0YXJ0IGFzIGRhdGUpICsgMyBtb250aHNdDQoNCmRlZmluZSAiUGF0aWVudCBvbiBUcmFjayI6DQogIG5vdCAiUGF0aWVudCBoYXMgYSBCUCBHb2FsIiBvciBub3QgIkhhcyBCUCBTZXQiIG9yICJCUCBHb2FsIE1ldCIgb3IgZW5kIG9mICJHb2FsIEludGVydmFsIiA+IFRvZGF5KCkNCg0KZGVmaW5lICJBY3RpdmUgTWVkaWNhdGlvbiBSZXF1ZXN0cyI6DQogIFsiTWVkaWNhdGlvblJlcXVlc3QiXSBSeCB3aGVyZSBSeC5zdGF0dXMudmFsdWUgfiAiQWN0aXZlIE1lZGljYXRpb24gUmVxdWVzdCIuY29kZQ0KDQpkZWZpbmUgIk1lZGljYXRpb24gUmVxdWVzdHMgV2l0aCBNZWRpY2F0aW9uIjoNCiAgIkFjdGl2ZSBNZWRpY2F0aW9uIFJlcXVlc3RzIiBSeA0KICAgIGxldCBtZWRpY2F0aW9uOiBzaW5nbGV0b24gZnJvbSAoW01lZGljYXRpb246IGlkIGluIExhc3QoU3BsaXQoUngubWVkaWNhdGlvbi5yZWZlcmVuY2UsICcvJykpXSkNCiAgICByZXR1cm4NCiAgICAgIE1lZGljYXRpb25SZXF1ZXN0IHsNCiAgICAgICAgaWQ6IFJ4LmlkLA0KICAgICAgICBzdGF0dXM6IFJ4LnN0YXR1cywNCiAgICAgICAgaW50ZW50OiBSeC5pbnRlbnQsDQogICAgICAgIGNhdGVnb3J5OiBSeC5jYXRlZ29yeSwNCiAgICAgICAgbWVkaWNhdGlvbjogbWVkaWNhdGlvbi5jb2RlLA0KICAgICAgICBzdWJqZWN0OiBSeC5zdWJqZWN0LA0KICAgICAgICBhdXRob3JlZE9uOiBSeC5hdXRob3JlZE9uLA0KICAgICAgICByZWNvcmRlcjogUngucmVjb3JkZXIsDQogICAgICAgIGRvc2FnZUluc3RydWN0aW9uOiBSeC5kb3NhZ2VJbnN0cnVjdGlvbiwNCiAgICAgICAgZGlzcGVuc2VSZXF1ZXN0OiBSeC5kaXNwZW5zZVJlcXVlc3QNCiAgICAgIH0NCg0KZGVmaW5lICJQYXRpZW50IGlzIFVzaW5nIEFudGloeXBlcnRlbnNpdmUgTWVkaWNhdGlvbnMiOg0KICAiTWVkaWNhdGlvbiBSZXF1ZXN0cyBXaXRoIE1lZGljYXRpb24iLm1lZGljYXRpb24gaW4gIkFudGloeXBlcnRlbnNpdmUgTWVkaWNhdGlvbnMiDQo="
  } ]
}