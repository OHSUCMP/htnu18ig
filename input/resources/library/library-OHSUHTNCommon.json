{
  "resourceType": "Library",
  "id": "library-OHSUHTNCommon",
  "extension": [ {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  } ],
  "url": "http://fhir.org/guides/ohsu/htnu18ig/Library/OHSUHTNCommon",
  "version": "0.1",
  "name": "OHSUHTNCommon",
  "title": "Common Logic",
  "description": "Common logic spanning multiple interventions.",
  "content": [ {
    "contentType": "text/cql",
    "data": "bGlicmFyeSBPSFNVSFROQ29tbW9uIHZlcnNpb24gJzAuMScKCnVzaW5nIEZISVIgdmVyc2lvbiAnNC4wLjEnCgppbmNsdWRlIEZISVJIZWxwZXJzIHZlcnNpb24gJzQuMC4xJyBjYWxsZWQgRkhJUkhlbHBlcnMKCmNvZGVzeXN0ZW0gIkxPSU5DIjogJ2h0dHA6Ly9sb2luYy5vcmcnCmNvZGVzeXN0ZW0gIlNOT01FRCI6ICdodHRwOi8vc25vbWVkLmluZm8vc2N0Jwpjb2Rlc3lzdGVtICJDb25kaXRpb25DbGluaWNhbFN0YXR1c0NvZGVzIjogJ2h0dHA6Ly90ZXJtaW5vbG9neS5obDcub3JnL0NvZGVTeXN0ZW0vY29uZGl0aW9uLWNsaW5pY2FsJwpjb2Rlc3lzdGVtICJDb25kaXRpb25WZXJpZmljYXRpb25TdGF0dXNDb2RlcyI6ICdodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL2NvbmRpdGlvbi12ZXItc3RhdHVzJwpjb2Rlc3lzdGVtICJ2MyBDb2RlIFN5c3RlbSBBY3RDb2RlIjogJ2h0dHA6Ly90ZXJtaW5vbG9neS5obDcub3JnL0NvZGVTeXN0ZW0vdjMtQWN0Q29kZScKY29kZXN5c3RlbSAiQ29uZGl0aW9uQ2F0ZWdvcnlTeXN0ZW0iOiAnaHR0cDovL3Rlcm1pbm9sb2d5LmhsNy5vcmcvQ29kZVN5c3RlbS9jb25kaXRpb24tY2F0ZWdvcnknCmNvZGVzeXN0ZW0gIk1lZGljYXRpb24gcmVxdWVzdCBzdGF0dXMiOiAnaHR0cDovL2hsNy5vcmcvZmhpci9Db2RlU3lzdGVtL21lZGljYXRpb25yZXF1ZXN0LXN0YXR1cycKCnZhbHVlc2V0ICJTeXN0b2xpYyBibG9vZCBwcmVzc3VyZSI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM3NjIuMS40LjExMDQuMicKdmFsdWVzZXQgIkRpYXN0b2xpYyBCbG9vZCBQcmVzc3VyZSI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM4ODMuMy41MjYuMi4xMDQ1Jwp2YWx1ZXNldCAiQmxvb2QgUHJlc3N1cmUgTWVhc3VyZWQiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzODgzLjMuNjAwLjIwMTInCnZhbHVlc2V0ICJBbWJ1bGF0b3J5IEJsb29kIFByZXNzdXJlIE1vbml0b3JpbmcgKEFCUE0pIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTA0Ny41MTEnCnZhbHVlc2V0ICJBbnRpaHlwZXJ0ZW5zaXZlIE1lZGljYXRpb25zIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTE3OC4xMCcKCi8qIFBvc3NpYmxlIGV4Y2x1c2lvbnMgZnJvbSB3b3JrZmxvd3MgKi8KdmFsdWVzZXQgIkh5cGVydGVuc2lvbiI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM4ODMuMy4zMTU3LjQwMTInCnZhbHVlc2V0ICJOb24gZXNzZW50aWFsIEh5cGVydGVuc2lvbiBTTk9NRURDVCI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM3NjIuMS40LjEwMzIuMTAnCnZhbHVlc2V0ICJQcmVnbmFuY3kiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzODgzLjMuNTI2LjMuMzc4Jwp2YWx1ZXNldCAiRW5kIFN0YWdlIFJlbmFsIERpc2Vhc2UiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzODgzLjMuNTI2LjIuNTkwJwp2YWx1ZXNldCAiSG9zcGljZSBjYXJlIGFtYnVsYXRvcnkiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzNzYyLjEuNC4xMTA4LjE1JwoKY29kZSAiYW1idWxhdG9yeSI6ICdBTUInIGZyb20gInYzIENvZGUgU3lzdGVtIEFjdENvZGUiIGRpc3BsYXkgJ2FtYnVsYXRvcnknCgovLyBDb25kaXRpb24gQ2xpbmljYWwgU3RhdHVzIENvZGVzIC0gQ29uc2lkZXIgdmFsdWUgc2V0cyBmb3IgdGhlc2UKY29kZSAiYWN0aXZlIjogJ2FjdGl2ZScgZnJvbSAiQ29uZGl0aW9uQ2xpbmljYWxTdGF0dXNDb2RlcyIKY29kZSAicmVjdXJyZW5jZSI6ICdyZWN1cnJlbmNlJyBmcm9tICJDb25kaXRpb25DbGluaWNhbFN0YXR1c0NvZGVzIgpjb2RlICJyZWxhcHNlIjogJ3JlbGFwc2UnIGZyb20gIkNvbmRpdGlvbkNsaW5pY2FsU3RhdHVzQ29kZXMiCmNvZGUgImluYWN0aXZlIjogJ2luYWN0aXZlJyBmcm9tICJDb25kaXRpb25DbGluaWNhbFN0YXR1c0NvZGVzIgpjb2RlICJyZW1pc3Npb24iOiAncmVtaXNzaW9uJyBmcm9tICJDb25kaXRpb25DbGluaWNhbFN0YXR1c0NvZGVzIgpjb2RlICJyZXNvbHZlZCI6ICdyZXNvbHZlZCcgZnJvbSAiQ29uZGl0aW9uQ2xpbmljYWxTdGF0dXNDb2RlcyIKCi8vIENvbmRpdGlvbiBWZXJpZmljYXRpb24gU3RhdHVzIENvZGVzIC0gQ29uc2lkZXIgdmFsdWUgc2V0cyBmb3IgdGhlc2UKY29kZSAidW5jb25maXJtZWQiOiAndW5jb25maXJtZWQnIGZyb20gQ29uZGl0aW9uVmVyaWZpY2F0aW9uU3RhdHVzQ29kZXMKY29kZSAicHJvdmlzaW9uYWwiOiAncHJvdmlzaW9uYWwnIGZyb20gQ29uZGl0aW9uVmVyaWZpY2F0aW9uU3RhdHVzQ29kZXMKY29kZSAiZGlmZmVyZW50aWFsIjogJ2RpZmZlcmVudGlhbCcgZnJvbSBDb25kaXRpb25WZXJpZmljYXRpb25TdGF0dXNDb2Rlcwpjb2RlICJjb25maXJtZWQiOiAnY29uZmlybWVkJyBmcm9tIENvbmRpdGlvblZlcmlmaWNhdGlvblN0YXR1c0NvZGVzCmNvZGUgInJlZnV0ZWQiOiAncmVmdXRlZCcgZnJvbSBDb25kaXRpb25WZXJpZmljYXRpb25TdGF0dXNDb2Rlcwpjb2RlICJlbnRlcmVkLWluLWVycm9yIjogJ2VudGVyZWQtaW4tZXJyb3InIGZyb20gQ29uZGl0aW9uVmVyaWZpY2F0aW9uU3RhdHVzQ29kZXMKCmNvZGUgInByb2JsZW0tbGlzdC1pdGVtIjogJ3Byb2JsZW0tbGlzdC1pdGVtJyBmcm9tICJDb25kaXRpb25DYXRlZ29yeVN5c3RlbSIgZGlzcGxheSAnUHJvYmxlbSBMaXN0IEl0ZW0nCmNvZGUgImVuY291bnRlci1kaWFnbm9zaXMiOiAnZW5jb3VudGVyLWRpYWdub3NpcycgZnJvbSAiQ29uZGl0aW9uQ2F0ZWdvcnlTeXN0ZW0iIGRpc3BsYXkgJ0VuY291bnRlciBEaWFnbm9zaXMnCgpjb2RlICJob21lLW1lYXN1cmVtZW50IjogJzI2NDM2MjAwMycgZnJvbSAiU05PTUVEIgoKY29kZSAiQWN0aXZlIE1lZGljYXRpb24gUmVxdWVzdCI6ICdhY3RpdmUnIGZyb20gIk1lZGljYXRpb24gcmVxdWVzdCBzdGF0dXMiCgpjb250ZXh0IFBhdGllbnQKCmRlZmluZSBmdW5jdGlvbiAiQXZnIFN5c3RvbGljIEJQIihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOgogIEF2ZyhsaXN0IE8KICAgIHJldHVybiBhbGwgRkhJUkhlbHBlcnMuVG9RdWFudGl0eShzaW5nbGV0b24gZnJvbSAoTy5jb21wb25lbnQgQyB3aGVyZSBDLmNvZGUgaW4gIlN5c3RvbGljIGJsb29kIHByZXNzdXJlIikudmFsdWUpCiAgKQoKZGVmaW5lIGZ1bmN0aW9uICJBdmcgRGlhc3RvbGljIEJQIihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOgogIEF2ZyhsaXN0IE8KICAgIHJldHVybiBhbGwgRkhJUkhlbHBlcnMuVG9RdWFudGl0eShzaW5nbGV0b24gZnJvbSAoTy5jb21wb25lbnQgQyB3aGVyZSBDLmNvZGUgaW4gIkRpYXN0b2xpYyBCbG9vZCBQcmVzc3VyZSIpLnZhbHVlKQogICkKCmRlZmluZSBmdW5jdGlvbiAiQXZnIEJQIihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOgogIFR1cGxlIHsgc3lzdG9saWM6ICJBdmcgU3lzdG9saWMgQlAiKGxpc3QpLCBkaWFzdG9saWM6ICJBdmcgRGlhc3RvbGljIEJQIihsaXN0KSB9CgpkZWZpbmUgZnVuY3Rpb24gIkF2ZyBCUCBTdHJpbmciKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6CiAgKCJBdmcgQlAiKGxpc3QpKSBPCiAgICByZXR1cm4gVG9TdHJpbmcoUm91bmQoTy5zeXN0b2xpYy52YWx1ZSkpICsgJy8nICsgVG9TdHJpbmcoUm91bmQoTy5kaWFzdG9saWMudmFsdWUpKSArICcgJyArIE8uc3lzdG9saWMudW5pdAoKZGVmaW5lIGZ1bmN0aW9uICJOb3JtYWwgQlAiKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6CiAgKCJBdmcgQlAiKGxpc3QpKSBPCiAgICB3aGVyZSBPLnN5c3RvbGljLnZhbHVlIDwgMTMwCiAgICBhbmQgTy5kaWFzdG9saWMudmFsdWUgPCA4MAoKZGVmaW5lIGZ1bmN0aW9uICJFbGV2YXRlZCBvciBBYm92ZSBCUCIobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToKICAoIkF2ZyBCUCIobGlzdCkpIE8KICAgIHdoZXJlIE8uc3lzdG9saWMudmFsdWUgPj0gMTMwCiAgICBvciBPLmRpYXN0b2xpYy52YWx1ZSA+PSA4MAoKZGVmaW5lIGZ1bmN0aW9uICJIVE4gU3RhZ2UgMSBCUCIobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToKICAoIkF2ZyBCUCIobGlzdCkpIE8KICAgIHdoZXJlIChPLnN5c3RvbGljLnZhbHVlID49IDEzMCBhbmQgTy5zeXN0b2xpYy52YWx1ZSA8IDE0MCkKICAgIG9yIChPLmRpYXN0b2xpYy52YWx1ZSA+PSA4MCBhbmQgTy5kaWFzdG9saWMudmFsdWUgPCA5MCkKCmRlZmluZSBmdW5jdGlvbiAiSFROIFN0YWdlIDIgQlAiKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6CiAgKCJBdmcgQlAiKGxpc3QpKSBPCiAgICB3aGVyZSBPLnN5c3RvbGljLnZhbHVlID49IDE0MAogICAgb3IgTy5kaWFzdG9saWMudmFsdWUgPj0gOTAKCmRlZmluZSBmdW5jdGlvbiAiSFROIFN0YWdlIDIgQlAgU3lzdG9saWMgU2Vjb25kIFRlc3QiKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6CiAgKCJBdmcgQlAiKGxpc3QpKSBPCiAgICB3aGVyZSBPLnN5c3RvbGljLnZhbHVlID49IDE2MAoKZGVmaW5lIGZ1bmN0aW9uICJIVE4gQ3Jpc2lzIEJQIihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOgogICgiQXZnIEJQIihsaXN0KSkgTwogICAgd2hlcmUgTy5zeXN0b2xpYy52YWx1ZSA+PSAxODAKICAgIG9yIE8uZGlhc3RvbGljLnZhbHVlID49IDEyMAoKZGVmaW5lIGZ1bmN0aW9uICJTeXN0b2xpYyBCUCBWYXJpYWJpbGl0eSIobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToKICBpZiBsaXN0IGlzIG51bGwgdGhlbgogICAgbnVsbAogIGVsc2UgaWYgQ291bnQobGlzdCkgPD0gMSB0aGVuCiAgICBudWxsCiAgZWxzZQogICAgU3RkRGV2KGxpc3QgTwogICAgICByZXR1cm4gYWxsIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoc2luZ2xldG9uIGZyb20gKE8uY29tcG9uZW50IEMgd2hlcmUgQy5jb2RlIGluICJTeXN0b2xpYyBibG9vZCBwcmVzc3VyZSIpLnZhbHVlKQogICkKCmRlZmluZSBmdW5jdGlvbiAiU3lzdG9saWMgQlAgVmFyaWFiaWxpdHkgU3RyaW5nIihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOgogICgiU3lzdG9saWMgQlAgVmFyaWFiaWxpdHkiKGxpc3QpKSBTCiAgICByZXR1cm4gVG9TdHJpbmcoUm91bmQoUy52YWx1ZSwgMSkpICsgJyAnICsgUy51bml0CgoKLyogSGVscGVycyAqLwpkZWZpbmUgZnVuY3Rpb24gV2l0aFVuaXQobGlzdCBMaXN0PE9ic2VydmF0aW9uPiwgVW5pdCBTdHJpbmcpOgogIGxpc3QgT2JzZXJ2YXRpb25zCiAgICB3aGVyZSAoCiAgICAgICgoc2luZ2xldG9uIGZyb20gKE9ic2VydmF0aW9ucy5jb21wb25lbnQgQyB3aGVyZSBDLmNvZGUgaW4gIlN5c3RvbGljIGJsb29kIHByZXNzdXJlIikudmFsdWUgYXMgRkhJUi5RdWFudGl0eSkudW5pdC52YWx1ZSB+IFVuaXQKICAgICAgICBhbmQgKHNpbmdsZXRvbiBmcm9tIChPYnNlcnZhdGlvbnMuY29tcG9uZW50IEMgd2hlcmUgQy5jb2RlIGluICJEaWFzdG9saWMgQmxvb2QgUHJlc3N1cmUiKS52YWx1ZSBhcyBGSElSLlF1YW50aXR5KS51bml0LnZhbHVlIH4gVW5pdCkKICAgICAgb3IgKChzaW5nbGV0b24gZnJvbSAoT2JzZXJ2YXRpb25zLmNvbXBvbmVudCBDIHdoZXJlIEMuY29kZSBpbiAiU3lzdG9saWMgYmxvb2QgcHJlc3N1cmUiKS52YWx1ZSBhcyBGSElSLlF1YW50aXR5KS5jb2RlLnZhbHVlIH4gVW5pdAogICAgICAgIGFuZCAoc2luZ2xldG9uIGZyb20gKE9ic2VydmF0aW9ucy5jb21wb25lbnQgQyB3aGVyZSBDLmNvZGUgaW4gIkRpYXN0b2xpYyBCbG9vZCBQcmVzc3VyZSIpLnZhbHVlIGFzIEZISVIuUXVhbnRpdHkpLmNvZGUudmFsdWUgfiBVbml0KQogICAgKQoKZGVmaW5lIGZ1bmN0aW9uIFdpdGhVbml0KHZhbHVlIFF1YW50aXR5LCBVbml0IFN0cmluZyk6CiAgKAogICAgdmFsdWUgcXVhbnRpdHkKICAgIHdoZXJlICgKICAgICAgcXVhbnRpdHkuY29kZS52YWx1ZSB+IFVuaXQKICAgICAgb3IgcXVhbnRpdHkudW5pdC52YWx1ZSB+IFVuaXQKICAgICkKICApIGlzIG5vdCBudWxsCgoKZGVmaW5lIGZ1bmN0aW9uIFF1YWxpZmllZEVuY291bnRlcihsaXN0IExpc3Q8RkhJUi5FbmNvdW50ZXI+KToKICBsaXN0IEVuY291bnRlcgogICAgLy9wbGFubmVkIHwgYXJyaXZlZCB8IHRyaWFnZWQgfCBpbi1wcm9ncmVzcyB8IG9ubGVhdmUgfCBmaW5pc2hlZCB8IGNhbmNlbGxlZCArCiAgICB3aGVyZSBFbmNvdW50ZXIuc3RhdHVzIH4gJ2ZpbmlzaGVkJwoKZGVmaW5lIGZ1bmN0aW9uIFF1YWxpZmllZENvbmRpdGlvbihsaXN0IExpc3Q8RkhJUi5Db25kaXRpb24+KToKICBsaXN0IENvbmRpdGlvbgogICAgLy9hY3RpdmUgfCByZWN1cnJlbmNlIHwgcmVsYXBzZSB8IGluYWN0aXZlIHwgcmVtaXNzaW9uIHwgcmVzb2x2ZWQKICAgIC8vd2hlcmUgQWN0aXZlQ29uZGl0aW9uKENvbmRpdGlvbikgaXMgbm90IG51bGwKICAgIC8vdW5jb25maXJtZWQgfCBwcm92aXNpb25hbCB8IGRpZmZlcmVudGlhbCB8IGNvbmZpcm1lZCB8IHJlZnV0ZWQgfCBlbnRlcmVkLWluLWVycm9yCiAgICB3aGVyZSBDb25maXJtZWRDb25kaXRpb24oQ29uZGl0aW9uKSBpcyBub3QgbnVsbAoKZGVmaW5lIGZ1bmN0aW9uIFF1YWxpZmllZE9ic2VydmF0aW9uKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6CiAgbGlzdCBPYnNlcnZhdGlvbgoJCXdoZXJlICgKICAgICAgLy9yZWdpc3RlcmVkIHwgcHJlbGltaW5hcnkgfCBmaW5hbCB8IGFtZW5kZWQgfCBjb3JyZWN0ZWQgfCBjYW5jZWxsZWQgfCBlbnRlcmVkLWluLWVycm9yIHwgdW5rbm93bgoJCQlPYnNlcnZhdGlvbi5zdGF0dXMgfiAnZmluYWwnCgkJCW9yIE9ic2VydmF0aW9uLnN0YXR1cyB+ICdhbWVuZGVkJwoJCQlvciBPYnNlcnZhdGlvbi5zdGF0dXMgfiAnY29ycmVjdGVkJwoJCSkKCmRlZmluZSBmdW5jdGlvbiBRdWFsaWZpZWRQcm9jZWR1cmUobGlzdCBMaXN0PEZISVIuUHJvY2VkdXJlPik6CiAgbGlzdCBQcm9jZWR1cmUKICAgIC8vcHJlcGFyYXRpb24gfCBpbi1wcm9ncmVzcyB8IG5vdC1kb25lIHwgb24taG9sZCB8IHN0b3BwZWQgfCBjb21wbGV0ZWQgfCBlbnRlcmVkLWluLWVycm9yIHwgdW5rbm93bgogICAgd2hlcmUgUHJvY2VkdXJlLnN0YXR1cyB+ICdjb21wbGV0ZWQnCgpkZWZpbmUgZnVuY3Rpb24gQ29uZmlybWVkQ29uZGl0aW9uKGxpc3QgTGlzdDxDb25kaXRpb24+KToKICBsaXN0IENvbmRpdGlvbgogICAgd2hlcmUgRkhJUkhlbHBlcnMuVG9Db25jZXB0KENvbmRpdGlvbi52ZXJpZmljYXRpb25TdGF0dXMpIH4gImNvbmZpcm1lZCIKCmRlZmluZSBmdW5jdGlvbiBDb25maXJtZWRDb25kaXRpb24odmFsdWUgQ29uZGl0aW9uKToKICB2YWx1ZSBDb25kaXRpb24KICAgIHdoZXJlIEZISVJIZWxwZXJzLlRvQ29uY2VwdChDb25kaXRpb24udmVyaWZpY2F0aW9uU3RhdHVzKSB+ICJjb25maXJtZWQiCgpkZWZpbmUgZnVuY3Rpb24gQWN0aXZlQ29uZGl0aW9uKGxpc3QgTGlzdDxDb25kaXRpb24+KToKICBsaXN0IENvbmRpdGlvbgogICAgd2hlcmUgRkhJUkhlbHBlcnMuVG9Db25jZXB0KENvbmRpdGlvbi5jbGluaWNhbFN0YXR1cykgfiAiYWN0aXZlIgogICAgICBhbmQgQ29uZGl0aW9uLmFiYXRlbWVudCBpcyBudWxsCgpkZWZpbmUgZnVuY3Rpb24gQWN0aXZlQ29uZGl0aW9uKHZhbHVlIENvbmRpdGlvbik6CiAgdmFsdWUgQ29uZGl0aW9uCiAgICB3aGVyZSBGSElSSGVscGVycy5Ub0NvbmNlcHQoQ29uZGl0aW9uLmNsaW5pY2FsU3RhdHVzKSB+ICJhY3RpdmUiCiAgICAgIGFuZCBDb25kaXRpb24uYWJhdGVtZW50IGlzIG51bGwKCmRlZmluZSBmdW5jdGlvbiBBY3RpdmVPclJlY3VycmluZyhsaXN0IExpc3Q8Q29uZGl0aW9uPik6CiAgbGlzdCBDb25kaXRpb24KICAgIHdoZXJlICgKICAgICAgRkhJUkhlbHBlcnMuVG9Db25jZXB0KENvbmRpdGlvbi5jbGluaWNhbFN0YXR1cykgfiAiYWN0aXZlIgogICAgICAgIGFuZCBDb25kaXRpb24uYWJhdGVtZW50IGlzIG51bGwKICAgICAgKQogICAgICBvciBGSElSSGVscGVycy5Ub0NvbmNlcHQoQ29uZGl0aW9uLmNsaW5pY2FsU3RhdHVzKSB+ICJyZWxhcHNlIgoKLy8gRXBpYyBzb21ldGltZXMgcHJvdmlkZXMgdGhlIG9pZCBpbnN0ZWFkIG9mIHRoZSBuYW1lZCBzeXN0ZW0sIGJ1dCB3ZSBuZWVkIHRoZSBuYW1lZCBzeXN0ZW0gZm9yIGNvbXBhcmluZyB0byBWYWx1ZVNldHMKZGVmaW5lIGZ1bmN0aW9uIEZpeEVwaWNTeXN0ZW1NYXBwaW5nKHN5c3RlbSBTdHJpbmcpOgogIGlmIE1hdGNoZXMoc3lzdGVtLCAndXJuOm9pZDoyLjE2Ljg0MC4xLjExMzg4My42Ljk2JykgdGhlbiAnaHR0cDovL3Nub21lZC5pbmZvL3NjdCcKICBlbHNlIGlmIE1hdGNoZXMoc3lzdGVtLCAndXJuOm9pZDoyLjE2Ljg0MC4xLjExMzg4My42LjkwJykgdGhlbiAnaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwLWNtJwogIGVsc2Ugc3lzdGVtCgovLyBUYWtlIHRoZSBsaXN0IG9mIENvZGVzIGFuZCByZXBsYWNlIHRoZSBzeXN0ZW1zIHdoZW4gbmVlZGVkCmRlZmluZSBmdW5jdGlvbiBUcmFuZm9ybUNvZGVMaXN0KGxpc3QgTGlzdDxTeXN0ZW0uQ29kZT4pOgogIGxpc3QgY29kaW5nCiAgcmV0dXJuIFN5c3RlbS5Db2RlIHsKICAgIGNvZGU6IGNvZGluZy5jb2RlLAogICAgc3lzdGVtOiBGaXhFcGljU3lzdGVtTWFwcGluZyhjb2Rpbmcuc3lzdGVtKSwKICAgIHZlcnNpb246IGNvZGluZy52ZXJzaW9uLAogICAgZGlzcGxheTogY29kaW5nLmRpc3BsYXkKICB9CgovLyBUcmFuc2Zvcm0gdGhlIGNvZGVzIGluIHRoZSBDb2RlYWJsZUNvbmNlcHQsIHJlcGxhY2luZyB0aGUgc3lzdGVtcyB3aGVuIG5lZWRlZApkZWZpbmUgZnVuY3Rpb24gVHJhbnNmb3JtQ29kZWFibGVDb25jZXB0KGNjIEZISVIuQ29kZWFibGVDb25jZXB0KToKICBUcmFuZm9ybUNvZGVMaXN0KEZISVJIZWxwZXJzLlRvQ29uY2VwdChjYykuY29kZXMpCgpkZWZpbmUgZnVuY3Rpb24gUXVhbGlmaWVkR29hbChsaXN0IExpc3Q8R29hbD4pOgogIGxpc3QgR29hbAogICAgLy9wcm9wb3NlZCB8IHBsYW5uZWQgfCBhY2NlcHRlZCB8IGFjdGl2ZSB8IG9uLWhvbGQgfCBjb21wbGV0ZWQgfCBjYW5jZWxsZWQgfCBlbnRlcmVkLWluLWVycm9yIHwgcmVqZWN0ZWQKICAgIHdoZXJlICgKICAgICAgR29hbC5saWZlY3ljbGVTdGF0dXMgfiAncHJvcG9zZWQnCiAgICAgIG9yIEdvYWwubGlmZWN5Y2xlU3RhdHVzIH4gJ3BsYW5uZWQnCiAgICAgIG9yIEdvYWwubGlmZWN5Y2xlU3RhdHVzIH4gJ2FjY2VwdGVkJwogICAgICBvciBHb2FsLmxpZmVjeWNsZVN0YXR1cyB+ICdhY3RpdmUnCiAgICAgIG9yIEdvYWwubGlmZWN5Y2xlU3RhdHVzIH4gJ2NvbXBsZXRlZCcKICAgICkKCgpkZWZpbmUgZnVuY3Rpb24gIkdldElkIih1cmkgU3RyaW5nKToKCUxhc3QoU3BsaXQodXJpLCAnLycpKQoKLyoKQGRlc2NyaXB0aW9uOiBOb3JtYWxpemVzIGEgdmFsdWUgdGhhdCBpcyBhIGNob2ljZSBvZiB0aW1pbmctdmFsdWVkIHR5cGVzIHRvIGFuIGVxdWl2YWxlbnQgaW50ZXJ2YWwKQGNvbW1lbnQ6IE5vcm1hbGl6ZXMgYSBjaG9pY2UgdHlwZSBvZiBGSElSLmRhdGVUaW1lLCBGSElSLlBlcmlvZCwgRkhJUi5UaW1pbmcsIEZISVIuaW5zdGFuY2UsIEZISVIuc3RyaW5nLCBGSElSLkFnZSwgb3IgRkhJUi5SYW5nZSB0eXBlcwp0byBhbiBlcXVpdmFsZW50IGludGVydmFsLiBUaGlzIHNlbGVjdGlvbiBvZiBjaG9pY2UgdHlwZXMgaXMgYSBzdXBlcnNldCBvZiB0aGUgbWFqb3JpdHkgb2YgY2hvaWNlIHR5cGVzIHRoYXQgYXJlIHVzZWQgYXMgcG9zc2libGUKcmVwcmVzZW50YXRpb25zIGZvciB0aW1pbmctdmFsdWVkIGVsZW1lbnRzIGluIEZISVIsIGFsbG93aW5nIHRoaXMgZnVuY3Rpb24gdG8gYmUgdXNlZCBhY3Jvc3MgYW55IHJlc291cmNlLiBOT1RFOiBEdWUgdG8gdGhlCmNvbXBsZXhpdHkgb2YgZGV0ZXJtaW5pbmcgYSBzaW5nbGUgaW50ZXJ2YWwgZnJvbSBhIFRpbWluZyBvciBTdHJpbmcgdHlwZSwgdGhpcyBmdW5jdGlvbiB3aWxsIHRocm93IGEgcnVuLXRpbWUgZXhjZXB0aW9uIGlmIGl0IGlzIHVzZWQKd2l0aCBhIFRpbWluZyBvciBTdHJpbmcuCiovCmRlZmluZSBmdW5jdGlvbiAiTm9ybWFsaXplIEludGVydmFsIihjaG9pY2UgQ2hvaWNlPEZISVIuZGF0ZVRpbWUsIEZISVIuUGVyaW9kLCBGSElSLlRpbWluZywgRkhJUi5pbnN0YW50LCBGSElSLnN0cmluZywgRkhJUi5BZ2UsIEZISVIuUmFuZ2U+KToKICBjYXNlCgkgIHdoZW4gY2hvaWNlIGlzIEZISVIuZGF0ZVRpbWUgdGhlbgogICAgCUludGVydmFsW0ZISVJIZWxwZXJzLlRvRGF0ZVRpbWUoY2hvaWNlIGFzIEZISVIuZGF0ZVRpbWUpLCBGSElSSGVscGVycy5Ub0RhdGVUaW1lKGNob2ljZSBhcyBGSElSLmRhdGVUaW1lKV0KCQl3aGVuIGNob2ljZSBpcyBGSElSLlBlcmlvZCB0aGVuCiAgCQlGSElSSGVscGVycy5Ub0ludGVydmFsKGNob2ljZSBhcyBGSElSLlBlcmlvZCkKCQl3aGVuIGNob2ljZSBpcyBGSElSLmluc3RhbnQgdGhlbgoJCQlJbnRlcnZhbFtGSElSSGVscGVycy5Ub0RhdGVUaW1lKGNob2ljZSBhcyBGSElSLmluc3RhbnQpLCBGSElSSGVscGVycy5Ub0RhdGVUaW1lKGNob2ljZSBhcyBGSElSLmluc3RhbnQpXQoJCXdoZW4gY2hvaWNlIGlzIEZISVIuQWdlIHRoZW4KCQkgIEludGVydmFsW0ZISVJIZWxwZXJzLlRvRGF0ZShQYXRpZW50LmJpcnRoRGF0ZSkgKyBGSElSSGVscGVycy5Ub1F1YW50aXR5KGNob2ljZSBhcyBGSElSLkFnZSksCgkJCSAgRkhJUkhlbHBlcnMuVG9EYXRlKFBhdGllbnQuYmlydGhEYXRlKSArIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoY2hvaWNlIGFzIEZISVIuQWdlKSArIDEgeWVhcikKCQl3aGVuIGNob2ljZSBpcyBGSElSLlJhbmdlIHRoZW4KCQkgIEludGVydmFsW0ZISVJIZWxwZXJzLlRvRGF0ZShQYXRpZW50LmJpcnRoRGF0ZSkgKyBGSElSSGVscGVycy5Ub1F1YW50aXR5KChjaG9pY2UgYXMgRkhJUi5SYW5nZSkubG93KSwKCQkJICBGSElSSGVscGVycy5Ub0RhdGUoUGF0aWVudC5iaXJ0aERhdGUpICsgRkhJUkhlbHBlcnMuVG9RdWFudGl0eSgoY2hvaWNlIGFzIEZISVIuUmFuZ2UpLmhpZ2gpICsgMSB5ZWFyKQoJCXdoZW4gY2hvaWNlIGlzIEZISVIuVGltaW5nIHRoZW4KCQkgIE1lc3NhZ2UobnVsbCBhcyBJbnRlcnZhbDxEYXRlVGltZT4sIHRydWUsICcxJywgJ0Vycm9yJywgJ0Nhbm5vdCBjb21wdXRlIGEgc2luZ2xlIGludGVydmFsIGZyb20gYSBUaW1pbmcgdHlwZScpCiAgICB3aGVuIGNob2ljZSBpcyBGSElSLnN0cmluZyB0aGVuCiAgICAgIE1lc3NhZ2UobnVsbCBhcyBJbnRlcnZhbDxEYXRlVGltZT4sIHRydWUsICcxJywgJ0Vycm9yJywgJ0Nhbm5vdCBjb21wdXRlIGFuIGludGVydmFsIGZyb20gYSBTdHJpbmcgdmFsdWUnKQoJCWVsc2UKCQkJbnVsbCBhcyBJbnRlcnZhbDxEYXRlVGltZT4KCWVuZAoKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIGFuIGludGVydmFsIHJlcHJlc2VudGluZyB0aGUgbm9ybWFsaXplZCBBYmF0ZW1lbnQgb2YgYSBnaXZlbiBDb25kaXRpb24gcmVzb3VyY2UuCkBjb21tZW50OiBOT1RFOiBEdWUgdG8gdGhlIGNvbXBsZXhpdHkgb2YgZGV0ZXJtaW5pbmcgYW4gaW50ZXJ2YWwgZnJvbSBhIFN0cmluZywgdGhpcyBmdW5jdGlvbiB3aWxsIHRocm93CmEgcnVuLXRpbWUgZXhjZXB0aW9uIGlmIHVzZWQgd2l0aCBhIENvbmRpdGlvbiBpbnN0YW5jZSB0aGF0IGhhcyBhIFN0cmluZyBhcyB0aGUgYWJhdGVtZW50IHZhbHVlLgoqLwpkZWZpbmUgZnVuY3Rpb24gIk5vcm1hbGl6ZSBBYmF0ZW1lbnQiKGNvbmRpdGlvbiBDb25kaXRpb24pOgogIGlmIGNvbmRpdGlvbi5hYmF0ZW1lbnQgaXMgRkhJUi5kYXRlVGltZSB0aGVuCiAgICBJbnRlcnZhbFtGSElSSGVscGVycy5Ub0RhdGVUaW1lKGNvbmRpdGlvbi5hYmF0ZW1lbnQgYXMgRkhJUi5kYXRlVGltZSksIEZISVJIZWxwZXJzLlRvRGF0ZVRpbWUoY29uZGl0aW9uLmFiYXRlbWVudCBhcyBGSElSLmRhdGVUaW1lKV0KICBlbHNlIGlmIGNvbmRpdGlvbi5hYmF0ZW1lbnQgaXMgRkhJUi5QZXJpb2QgdGhlbgogICAgRkhJUkhlbHBlcnMuVG9JbnRlcnZhbChjb25kaXRpb24uYWJhdGVtZW50IGFzIEZISVIuUGVyaW9kKQogIGVsc2UgaWYgY29uZGl0aW9uLmFiYXRlbWVudCBpcyBGSElSLnN0cmluZyB0aGVuCiAgICBNZXNzYWdlKG51bGwgYXMgSW50ZXJ2YWw8RGF0ZVRpbWU+LCB0cnVlLCAnMScsICdFcnJvcicsICdDYW5ub3QgY29tcHV0ZSBhbiBpbnRlcnZhbCBmcm9tIGEgU3RyaW5nIHZhbHVlJykKICBlbHNlIGlmIGNvbmRpdGlvbi5hYmF0ZW1lbnQgaXMgRkhJUi5BZ2UgdGhlbgogICAgSW50ZXJ2YWxbRkhJUkhlbHBlcnMuVG9EYXRlKFBhdGllbnQuYmlydGhEYXRlKSArIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoY29uZGl0aW9uLmFiYXRlbWVudCBhcyBGSElSLkFnZSksCiAgICAgIEZISVJIZWxwZXJzLlRvRGF0ZShQYXRpZW50LmJpcnRoRGF0ZSkgKyBGSElSSGVscGVycy5Ub1F1YW50aXR5KGNvbmRpdGlvbi5hYmF0ZW1lbnQgYXMgRkhJUi5BZ2UpICsgMSB5ZWFyKQogIGVsc2UgaWYgY29uZGl0aW9uLmFiYXRlbWVudCBpcyBGSElSLlJhbmdlIHRoZW4KICAgIEludGVydmFsW0ZISVJIZWxwZXJzLlRvRGF0ZShQYXRpZW50LmJpcnRoRGF0ZSkgKyBGSElSSGVscGVycy5Ub1F1YW50aXR5KChjb25kaXRpb24uYWJhdGVtZW50IGFzIEZISVIuUmFuZ2UpLmxvdyksCiAgICAgIEZISVJIZWxwZXJzLlRvRGF0ZShQYXRpZW50LmJpcnRoRGF0ZSkgKyBGSElSSGVscGVycy5Ub1F1YW50aXR5KChjb25kaXRpb24uYWJhdGVtZW50IGFzIEZISVIuUmFuZ2UpLmhpZ2gpICsgMSB5ZWFyKQogIGVsc2UgaWYgY29uZGl0aW9uLmFiYXRlbWVudCBpcyBGSElSLmJvb2xlYW4gdGhlbgogICAgSW50ZXJ2YWxbZW5kIG9mICJOb3JtYWxpemUgSW50ZXJ2YWwiKGNvbmRpdGlvbi5vbnNldCksIGNvbmRpdGlvbi5yZWNvcmRlZERhdGUpCiAgZWxzZSBudWxsCgovKgpAZGVzY3JpcHRpb246IFJldHVybnMgYW4gaW50ZXJ2YWwgcmVwcmVzZW50aW5nIHRoZSBub3JtYWxpemVkIHByZXZhbGVuY2UgcGVyaW9kIG9mIGEgZ2l2ZW4gQ29uZGl0aW9uIHJlc291cmNlLgoqLwpkZWZpbmUgZnVuY3Rpb24gIlByZXZhbGVuY2UgUGVyaW9kIihjb25kaXRpb24gQ29uZGl0aW9uKToKICBpZiBjb25kaXRpb24uY2xpbmljYWxTdGF0dXMgfiAiYWN0aXZlIgogICAgb3IgY29uZGl0aW9uLmNsaW5pY2FsU3RhdHVzIH4gInJlY3VycmVuY2UiCiAgICBvciBjb25kaXRpb24uY2xpbmljYWxTdGF0dXMgfiAicmVsYXBzZSIKICAgIC8vIFRoaXMgcHJldmVudHMgZXJyb3JzIHdoZW4gYSBjb25kaXRpb24gaGFzIGFuIG9uc2V0IGFuZCBhYmF0ZW1lbnQgb24gdGhlIHNhbWUgZGF5IGFuZCBubyB0aW1lc3RhbXAgaXMgcHJvdmlkZWQgKEVwaWMpCiAgICBvciBlbmQgb2YgIk5vcm1hbGl6ZSBBYmF0ZW1lbnQiKGNvbmRpdGlvbikgaXMgbm90IG51bGwgdGhlbgogICAgSW50ZXJ2YWxbc3RhcnQgb2YgIk5vcm1hbGl6ZSBJbnRlcnZhbCIoY29uZGl0aW9uLm9uc2V0KSwgZW5kIG9mICJOb3JtYWxpemUgQWJhdGVtZW50Iihjb25kaXRpb24pXQogIGVsc2UKICAgIC8vIFRoZSBjb25kaXRpb24gaXMgbm90IGFjdGl2ZSBidXQgaGFzIG5vIGFiYXRlbWVudCBkYXRlLCBzbyB3ZSBjYW4ndCBzYXkgd2hlbiBpdCBlbmRlZAogICAgSW50ZXJ2YWxbc3RhcnQgb2YgIk5vcm1hbGl6ZSBJbnRlcnZhbCIoY29uZGl0aW9uLm9uc2V0KSwgbnVsbCkKCi8qKioqKiBDb21tb24gRGF0YSAqKioqKi8KCi8qIFBvdGVudGlhbCBFeGNsdXNpb24gQ3JpdGVyaWEgKi8KZGVmaW5lICJQYXRpZW50IFVuZGVyIEFnZSAxOCI6CiAgQWdlSW5ZZWFyc0F0KFRvZGF5KCkpIDwgMTgKCmRlZmluZSAiUGF0aWVudCBPdmVyIEFnZSA4MCI6CiAgQWdlSW5ZZWFyc0F0KFRvZGF5KCkpID4gODAKCi8vIEdyYWIgYWxsIGNvbmRpdGlvbnMgZm9yIHBhdGllbnRzIHNpbmNlIHdlIGNhbid0IGxpbWl0IGJ5IGNvZGUgaW4gRXBpYy4KZGVmaW5lICJDb25kaXRpb25zIjoKICAoUXVhbGlmaWVkQ29uZGl0aW9uKFsiQ29uZGl0aW9uIjogY2F0ZWdvcnkgfiAicHJvYmxlbS1saXN0LWl0ZW0iXSkpIHVuaW9uCiAgKFF1YWxpZmllZENvbmRpdGlvbihbIkNvbmRpdGlvbiI6IGNhdGVnb3J5IH4gImVuY291bnRlci1kaWFnbm9zaXMiXSkpCgpkZWZpbmUgIkNvbmRpdGlvbiBJbmRpY2F0aW5nIEVuZCBTdGFnZSBSZW5hbCBEaXNlYXNlIjoKICAiQ29uZGl0aW9ucyIgUHJvYmxlbQogICAgd2hlcmUgVHJhbnNmb3JtQ29kZWFibGVDb25jZXB0KFByb2JsZW0uY29kZSkgaW4gIkVuZCBTdGFnZSBSZW5hbCBEaXNlYXNlIiBhbmQgZW5kIG9mICJQcmV2YWxlbmNlIFBlcmlvZCIoUHJvYmxlbSkgPj0gVG9kYXkoKQoKZGVmaW5lICJDb25kaXRpb24gSW5kaWNhdGluZyBQcmVnbmFuY3kiOgogICJDb25kaXRpb25zIiBQcm9ibGVtCiAgICB3aGVyZSBUcmFuc2Zvcm1Db2RlYWJsZUNvbmNlcHQoUHJvYmxlbS5jb2RlKSBpbiAiUHJlZ25hbmN5IiBhbmQgZW5kIG9mICJQcmV2YWxlbmNlIFBlcmlvZCIoUHJvYmxlbSkgPj0gVG9kYXkoKQoKZGVmaW5lICJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMiOgogIChXaXRoVW5pdChRdWFsaWZpZWRPYnNlcnZhdGlvbihbIk9ic2VydmF0aW9uIjogIkJsb29kIFByZXNzdXJlIE1lYXN1cmVkIl0pLCAnbW1bSGddJykpIE8KICAgICAgc29ydCBieSBDb2FsZXNjZShzdGFydCBvZiAiTm9ybWFsaXplIEludGVydmFsIihlZmZlY3RpdmUpLCBpc3N1ZWQpCgpkZWZpbmUgIk1vc3QgUmVjZW50IEJQIFJlYWRpbmciOgogIExhc3QoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyIgTyBzb3J0IGJ5IENvYWxlc2NlKHN0YXJ0IG9mICJOb3JtYWxpemUgSW50ZXJ2YWwiKGVmZmVjdGl2ZSksIGlzc3VlZCkpCgpkZWZpbmUgIkJQIFdpdGhpbiAxNCBkYXlzIjoKICAiTW9zdCBSZWNlbnQgQlAgUmVhZGluZyIgQlAKICByZXR1cm4gQ29hbGVzY2Uoc3RhcnQgb2YgIk5vcm1hbGl6ZSBJbnRlcnZhbCIoQlAuZWZmZWN0aXZlKSwgQlAuaXNzdWVkKSArIDE0IGRheXMgPj0gVG9kYXkoKQoKZGVmaW5lICJIVE4gQ3Jpc2lzIjoKICAiQlAgV2l0aGluIDE0IGRheXMiIGFuZCAiSFROIENyaXNpcyBCUCIoeyAiTW9zdCBSZWNlbnQgQlAgUmVhZGluZyIgfSkgaXMgbm90IG51bGwKCmRlZmluZSAiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMiOgogICJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMiIEJQIHdoZXJlICJOb3JtYWxpemUgSW50ZXJ2YWwiKEJQLmVmZmVjdGl2ZSkgc3RhcnRzIDI0IG1vbnRocyBvciBsZXNzIGJlZm9yZSBUb2RheSgpCiAgICBzb3J0IGJ5IENvYWxlc2NlKHN0YXJ0IG9mICJOb3JtYWxpemUgSW50ZXJ2YWwiKGVmZmVjdGl2ZSksIGlzc3VlZCkKCmRlZmluZSAiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyI6CiAgIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIiBPIHNvcnQgYnkgQ29hbGVzY2Uoc3RhcnQgb2YgIk5vcm1hbGl6ZSBJbnRlcnZhbCIoZWZmZWN0aXZlKSwgaXNzdWVkKSBkZXNjCgpkZWZpbmUgZnVuY3Rpb24gTWVhc3VyZW1lbnRTZXR0aW5ncyhsaXN0IExpc3Q8RXh0ZW5zaW9uPik6CiAgbGlzdCBFeHRlbnNpb24KICAgIHdoZXJlIEV4dGVuc2lvbi51cmwgPSAnaHR0cDovL2hsNy5vcmcvZmhpci91cy92aXRhbHMvU3RydWN0dXJlRGVmaW5pdGlvbi9NZWFzdXJlbWVudFNldHRpbmdFeHQnCiAgcmV0dXJuIEZISVJIZWxwZXJzLlRvQ29kZShFeHRlbnNpb24udmFsdWUpCgpkZWZpbmUgIkhvbWUgQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIjoKICAiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMiIEJQT2JzZXJ2YXRpb24KICAgIHdoZXJlICJNZWFzdXJlbWVudFNldHRpbmdzIihCUE9ic2VydmF0aW9uLmV4dGVuc2lvbikgY29udGFpbnMgImhvbWUtbWVhc3VyZW1lbnQiCgpkZWZpbmUgIk9mZmljZSBCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMiOgogICJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyIgZXhjZXB0ICJIb21lIEJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyIKCi8vIFJldmlzaXQgbG9naWMgd2hlbiByZWFkeSB0byBhZGRyZXNzIGFtYnVsYXRvcnkgb2JzZXJ2YXRpb25zLiBDaGVjayBvdXQgY29tbWl0IDU3MDQ2NDQ4YTI0ZDI0YTc2N2Q0MDJlNWZhOGE5Njc3OWE0ODhmMDIgZm9yIG9sZCBsb2dpYwpkZWZpbmUgIkFtYnVsYXRvcnkgQmxvb2QgUHJlc3N1cmUgTW9uaXRvcmluZyBPYnNlcnZhdGlvbnMiOgogIHt9CgpkZWZpbmUgIkhhcyBCUCBTZXQiOgogICAgaWYgbm90IGV4aXN0cyAiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMiIHRoZW4gZmFsc2UKICAgIGVsc2UgY2FsY3VsYXRlU2NvcmUoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIikgPj0gNAoKZGVmaW5lIGZ1bmN0aW9uIHNjb3JlKG9ic2VydmF0aW9uIE9ic2VydmF0aW9uKToKICBpZiBvYnNlcnZhdGlvbiBpbiAiQW1idWxhdG9yeSBCbG9vZCBQcmVzc3VyZSBNb25pdG9yaW5nIE9ic2VydmF0aW9ucyIgdGhlbiAwLjMzMwogIGVsc2UgaWYgb2JzZXJ2YXRpb24gaW4gIkhvbWUgQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIiB0aGVuIDAuNjY3CiAgZWxzZSAxCgpkZWZpbmUgZnVuY3Rpb24gY2FsY3VsYXRlU2NvcmUobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToKICBTdW0obGlzdCBPCiAgICByZXR1cm4gYWxsIHNjb3JlKE8pCiAgKQoKZGVmaW5lICJNb3N0IFJlY2VudCBCUCBTZXQiOgogIGlmIG5vdCAiSGFzIEJQIFNldCIgdGhlbiBudWxsCiAgZWxzZSBpZiBjYWxjdWxhdGVTY29yZShUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNCkpID49IDQgdGhlbiBUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNCkKICBlbHNlIGlmIGNhbGN1bGF0ZVNjb3JlKFRha2UoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIERlc2NlbmRpbmciLCA1KSkgPj0gNCB0aGVuIFRha2UoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIERlc2NlbmRpbmciLCA1KQogIGVsc2UgaWYgY2FsY3VsYXRlU2NvcmUoVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDYpKSA+PSA0IHRoZW4gVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDYpCiAgZWxzZSBpZiBjYWxjdWxhdGVTY29yZShUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNykpID49IDQgdGhlbiBUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgNykKICBlbHNlIGlmIGNhbGN1bGF0ZVNjb3JlKFRha2UoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIERlc2NlbmRpbmciLCA4KSkgPj0gNCB0aGVuIFRha2UoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIERlc2NlbmRpbmciLCA4KQogIGVsc2UgaWYgY2FsY3VsYXRlU2NvcmUoVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDkpKSA+PSA0IHRoZW4gVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDkpCiAgZWxzZSBpZiBjYWxjdWxhdGVTY29yZShUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgMTApKSA+PSA0IHRoZW4gVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDEwKQogIGVsc2UgaWYgY2FsY3VsYXRlU2NvcmUoVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDExKSkgPj0gNCB0aGVuIFRha2UoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIERlc2NlbmRpbmciLCAxMSkKICBlbHNlIGlmIGNhbGN1bGF0ZVNjb3JlKFRha2UoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIERlc2NlbmRpbmciLCAxMikpID49IDQgdGhlbiBUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgMTIpCiAgZWxzZSBudWxsCgpkZWZpbmUgIkF2ZXJhZ2UgQWxsIEJQIExhc3QgMiBZZWFycyI6CiAgIkF2ZyBCUCIoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIikKCmRlZmluZSAiQXZlcmFnZSBNb3N0IFJlY2VudCBCUCBTZXQiOgogICJBdmcgQlAiKCJNb3N0IFJlY2VudCBCUCBTZXQiKQoKLy8gSXMgbGFzdCBCUCBzZXQgb3IgYWxsIEJQcyBhdmdlID4gMTMwLzgwPwpkZWZpbmUgIlBhdGllbnQgSGFzIFBvdGVudGlhbCBIVE4gU3RhZ2UgMSBCUCI6CiAgKAogICAgIkhUTiBTdGFnZSAxIEJQIigiTW9zdCBSZWNlbnQgQlAgU2V0IikgaXMgbm90IG51bGwKICAgIG9yICJIVE4gU3RhZ2UgMSBCUCIoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIikgaXMgbm90IG51bGwKICApCgovLyBJcyBsYXN0IEJQIHNldCBvciBhbGwgQlBzIGF2ZXJhZ2UgPiAxNDAgU0JQIG9yID4gOTAgREJQPwpkZWZpbmUgIlBhdGllbnQgSGFzIFBvdGVudGlhbCBIVE4gU3RhZ2UgMiBCUCI6CiAgKAogICAgIkhUTiBTdGFnZSAyIEJQIigiTW9zdCBSZWNlbnQgQlAgU2V0IikgaXMgbm90IG51bGwKICAgIG9yICJIVE4gU3RhZ2UgMiBCUCIoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIikgaXMgbm90IG51bGwKICApCgovLyBJcyBTQlAgQ29lZmYgb2YgVmFyID4gMTEgZm9yIGFsbCBCUHMgYW5kIG5vIEFCUE0/CmRlZmluZSAiQlAgSGlnaGx5IFZhcmlhYmxlIjoKICBpZiAiSGFzIEJQIFNldCIgdGhlbgogICAgKAogICAgICAiU3lzdG9saWMgQlAgVmFyaWFiaWxpdHkiKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyIpLnZhbHVlID4gMTEKICAgICAgLy8gVGhpcyBsb2dpYyB3YXMgcmVtb3ZlZAogICAgICAvL2FuZCBub3QgZXhpc3RzICJBbWJ1bGF0b3J5IEJsb29kIFByZXNzdXJlIE1vbml0b3JpbmcgUHJvY2VkdXJlcyIKICAgICkKICBlbHNlIG51bGwKCmRlZmluZSAiQ29uZGl0aW9uIEluZGljYXRpbmcgUHJlZXhpc3RpbmcgSHlwZXJ0ZW5zaW9uIjoKICAiQ29uZGl0aW9ucyIgUHJvYmxlbQogICAgd2hlcmUgKFRyYW5zZm9ybUNvZGVhYmxlQ29uY2VwdChQcm9ibGVtLmNvZGUpIGluICJIeXBlcnRlbnNpb24iIG9yIFRyYW5zZm9ybUNvZGVhYmxlQ29uY2VwdChQcm9ibGVtLmNvZGUpIGluICJOb24gZXNzZW50aWFsIEh5cGVydGVuc2lvbiBTTk9NRURDVCIpIGFuZCBlbmQgb2YgIlByZXZhbGVuY2UgUGVyaW9kIihQcm9ibGVtKSA+PSBUb2RheSgpCgovLyBEb2VzIHBhdGllbnQgaGF2ZSBhIEJQIGdvYWw/CmRlZmluZSAiUXVhbGlmeWluZyBCbG9vZCBQcmVzc3VyZSBHb2FscyI6CiAgKFF1YWxpZmllZEdvYWwoWyJHb2FsIl0pKSBCUEdvYWwKICAgIHdoZXJlICgKICAgICAgc2luZ2xldG9uIGZyb20gKEJQR29hbC50YXJnZXQgU3lzdG9saWMKICAgICAgICB3aGVyZSBTeXN0b2xpYy5tZWFzdXJlIGluICJTeXN0b2xpYyBibG9vZCBwcmVzc3VyZSIKICAgICAgICAgIGFuZCBTeXN0b2xpYy5kZXRhaWwgaXMgUXVhbnRpdHkKICAgICAgICAgIGFuZCBXaXRoVW5pdChTeXN0b2xpYy5kZXRhaWwsICdtbVtIZ10nKSkKICAgICkgU3lzdG9saWNUYXJnZXQgaXMgbm90IG51bGwKICAgICAgYW5kICgKICAgICAgICBzaW5nbGV0b24gZnJvbSAoQlBHb2FsLnRhcmdldCBEaWFzdG9saWMKICAgICAgICAgIHdoZXJlIERpYXN0b2xpYy5tZWFzdXJlIGluICJEaWFzdG9saWMgQmxvb2QgUHJlc3N1cmUiCiAgICAgICAgICAgIGFuZCBEaWFzdG9saWMuZGV0YWlsIGlzIFF1YW50aXR5CiAgICAgICAgICAgIGFuZCBXaXRoVW5pdChEaWFzdG9saWMuZGV0YWlsLCAnbW1bSGddJykpCiAgICAgICkgRGlhc3RvbGljVGFyZ2V0IGlzIG5vdCBudWxsCgpkZWZpbmUgIk1vc3QgUmVjZW50bHkgRXN0YWJsaXNoZWQgQmxvb2QgUHJlc3N1cmUgR29hbCI6CiAgTGFzdCAoCiAgICAiUXVhbGlmeWluZyBCbG9vZCBQcmVzc3VyZSBHb2FscyIgQlBHb2FsCiAgICAgIHNvcnQgYnkgKHN0YXJ0IGFzIGRhdGUpCiAgKQoKZGVmaW5lICJQYXRpZW50IGhhcyBhIEJQIEdvYWwiOgogIGV4aXN0cyAiUXVhbGlmeWluZyBCbG9vZCBQcmVzc3VyZSBHb2FscyIKCgpkZWZpbmUgIkJQIGZyb20gTW9zdCBSZWNlbnQgR29hbCI6CiAgIk1vc3QgUmVjZW50bHkgRXN0YWJsaXNoZWQgQmxvb2QgUHJlc3N1cmUgR29hbCIgQlBHb2FsCiAgICByZXR1cm4gVHVwbGUgewogICAgICBzeXN0b2xpYzogc2luZ2xldG9uIGZyb20gKEJQR29hbC50YXJnZXQgU3lzdG9saWMgd2hlcmUgU3lzdG9saWMubWVhc3VyZSBpbiAiU3lzdG9saWMgYmxvb2QgcHJlc3N1cmUiKS5kZXRhaWwgYXMgUXVhbnRpdHksCiAgICAgIGRpYXN0b2xpYzogc2luZ2xldG9uIGZyb20gKEJQR29hbC50YXJnZXQgRGlhc3RvbGljIHdoZXJlIERpYXN0b2xpYy5tZWFzdXJlIGluICJEaWFzdG9saWMgQmxvb2QgUHJlc3N1cmUiKS5kZXRhaWwgYXMgUXVhbnRpdHkKICAgIH0KCmRlZmluZSAiQWJvdmUgR29hbCBBdmVyYWdlIE1vc3QgUmVjZW50IjoKICAiQXZlcmFnZSBNb3N0IFJlY2VudCBCUCBTZXQiLnN5c3RvbGljID4gIkJQIGZyb20gTW9zdCBSZWNlbnQgR29hbCIuc3lzdG9saWMgb3IKICAiQXZlcmFnZSBNb3N0IFJlY2VudCBCUCBTZXQiLmRpYXN0b2xpYyA+ICJCUCBmcm9tIE1vc3QgUmVjZW50IEdvYWwiLmRpYXN0b2xpYwoKZGVmaW5lICJCUCBHb2FsIE1ldCI6CiAgIlBhdGllbnQgaGFzIGEgQlAgR29hbCIgYW5kICJIYXMgQlAgU2V0IiBhbmQgbm90ICJBYm92ZSBHb2FsIEF2ZXJhZ2UgTW9zdCBSZWNlbnQiCiAgYW5kIG5vdCAiQlAgSGlnaGx5IFZhcmlhYmxlIgoKZGVmaW5lICJHb2FsIEludGVydmFsIjoKICBJbnRlcnZhbFsoIk1vc3QgUmVjZW50bHkgRXN0YWJsaXNoZWQgQmxvb2QgUHJlc3N1cmUgR29hbCIuc3RhcnQgYXMgZGF0ZSksCiAgICAoIk1vc3QgUmVjZW50bHkgRXN0YWJsaXNoZWQgQmxvb2QgUHJlc3N1cmUgR29hbCIuc3RhcnQgYXMgZGF0ZSkgKyAzIG1vbnRoc10KCmRlZmluZSAiUGF0aWVudCBvbiBUcmFjayI6CiAgbm90ICJQYXRpZW50IGhhcyBhIEJQIEdvYWwiIG9yIG5vdCAiSGFzIEJQIFNldCIgb3IgIkJQIEdvYWwgTWV0IiBvciBlbmQgb2YgIkdvYWwgSW50ZXJ2YWwiID4gVG9kYXkoKQoKZGVmaW5lICJBY3RpdmUgTWVkaWNhdGlvbiBSZXF1ZXN0cyI6CiAgWyJNZWRpY2F0aW9uUmVxdWVzdCJdIFJ4IHdoZXJlIFJ4LnN0YXR1cy52YWx1ZSB+ICJBY3RpdmUgTWVkaWNhdGlvbiBSZXF1ZXN0Ii5jb2RlCgpkZWZpbmUgIk1lZGljYXRpb24gUmVxdWVzdHMgV2l0aCBNZWRpY2F0aW9uIjoKICAiQWN0aXZlIE1lZGljYXRpb24gUmVxdWVzdHMiIFJ4CiAgICBsZXQgbWVkaWNhdGlvbjogc2luZ2xldG9uIGZyb20gKFtNZWRpY2F0aW9uOiBpZCBpbiBMYXN0KFNwbGl0KFJ4Lm1lZGljYXRpb24ucmVmZXJlbmNlLCAnLycpKV0pCiAgICByZXR1cm4KICAgICAgTWVkaWNhdGlvblJlcXVlc3QgewogICAgICAgIGlkOiBSeC5pZCwKICAgICAgICBzdGF0dXM6IFJ4LnN0YXR1cywKICAgICAgICBpbnRlbnQ6IFJ4LmludGVudCwKICAgICAgICBjYXRlZ29yeTogUnguY2F0ZWdvcnksCiAgICAgICAgbWVkaWNhdGlvbjogbWVkaWNhdGlvbi5jb2RlLAogICAgICAgIHN1YmplY3Q6IFJ4LnN1YmplY3QsCiAgICAgICAgYXV0aG9yZWRPbjogUnguYXV0aG9yZWRPbiwKICAgICAgICByZWNvcmRlcjogUngucmVjb3JkZXIsCiAgICAgICAgZG9zYWdlSW5zdHJ1Y3Rpb246IFJ4LmRvc2FnZUluc3RydWN0aW9uLAogICAgICAgIGRpc3BlbnNlUmVxdWVzdDogUnguZGlzcGVuc2VSZXF1ZXN0CiAgICAgIH0KCmRlZmluZSAiUGF0aWVudCBpcyBVc2luZyBBbnRpaHlwZXJ0ZW5zaXZlIE1lZGljYXRpb25zIjoKICAiTWVkaWNhdGlvbiBSZXF1ZXN0cyBXaXRoIE1lZGljYXRpb24iLm1lZGljYXRpb24gaW4gIkFudGloeXBlcnRlbnNpdmUgTWVkaWNhdGlvbnMiCg=="
  } ]
}