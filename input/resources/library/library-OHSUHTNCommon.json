{
  "resourceType": "Library",
  "id": "library-OHSUHTNCommon",
  "extension": [ {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  } ],
  "url": "http://fhir.org/guides/ohsuhypertensionig/Library/OHSUHTNCommon",
  "version": "0.1",
  "name": "OHSUHTNCommon",
  "title": "Common Logic",
  "description": "Common logic spanning multiple interventions.",
  "content": [ {
    "contentType": "text/cql",
    "data": "bGlicmFyeSBPSFNVSFROQ29tbW9uIHZlcnNpb24gJzAuMScNCg0KdXNpbmcgRkhJUiB2ZXJzaW9uICc0LjAuMScNCg0KaW5jbHVkZSBGSElSSGVscGVycyB2ZXJzaW9uICc0LjAuMScgY2FsbGVkIEZISVJIZWxwZXJzDQoNCmNvZGVzeXN0ZW0gIkxPSU5DIjogJ2h0dHA6Ly9sb2luYy5vcmcnDQpjb2Rlc3lzdGVtICJTTk9NRUQiOiAnaHR0cDovL3Nub21lZC5pbmZvL3NjdCcNCmNvZGVzeXN0ZW0gIkNvbmRpdGlvbkNsaW5pY2FsU3RhdHVzQ29kZXMiOiAnaHR0cDovL3Rlcm1pbm9sb2d5LmhsNy5vcmcvQ29kZVN5c3RlbS9jb25kaXRpb24tY2xpbmljYWwnDQpjb2Rlc3lzdGVtICJDb25kaXRpb25WZXJpZmljYXRpb25TdGF0dXNDb2RlcyI6ICdodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL2NvbmRpdGlvbi12ZXItc3RhdHVzJw0KY29kZXN5c3RlbSAidjMgQ29kZSBTeXN0ZW0gQWN0Q29kZSI6ICdodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL3YzLUFjdENvZGUnDQpjb2Rlc3lzdGVtICJDb25kaXRpb25DYXRlZ29yeVN5c3RlbSI6ICdodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL2NvbmRpdGlvbi1jYXRlZ29yeScNCmNvZGVzeXN0ZW0gIk1lZGljYXRpb24gcmVxdWVzdCBzdGF0dXMiOiAnaHR0cDovL2hsNy5vcmcvZmhpci9Db2RlU3lzdGVtL21lZGljYXRpb25yZXF1ZXN0LXN0YXR1cycNCg0KdmFsdWVzZXQgIlN5c3RvbGljIGJsb29kIHByZXNzdXJlIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTEwNC4yJw0KdmFsdWVzZXQgIkRpYXN0b2xpYyBCbG9vZCBQcmVzc3VyZSI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM4ODMuMy41MjYuMi4xMDQ1Jw0KdmFsdWVzZXQgIkJsb29kIFByZXNzdXJlIE1lYXN1cmVkIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzg4My4zLjYwMC4yMDEyJw0KdmFsdWVzZXQgIkFtYnVsYXRvcnkgQmxvb2QgUHJlc3N1cmUgTW9uaXRvcmluZyAoQUJQTSkiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzNzYyLjEuNC4xMDQ3LjUxMScNCnZhbHVlc2V0ICJBbnRpaHlwZXJ0ZW5zaXZlIE1lZGljYXRpb25zIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTE3OC4xMCcNCg0KLyogUG9zc2libGUgZXhjbHVzaW9ucyBmcm9tIHdvcmtmbG93cyAqLw0KLyogdmFsdWVzZXQgIkh5cGVydGVuc2lvbiI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM4ODMuMy4zMTU3LjQwMTInICovDQp2YWx1ZXNldCAiSHlwZXJ0ZW5zaW9uIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzg4My4zLjQ2NC4xMDAzLjEwNC4xMi4xMDE2Jw0KdmFsdWVzZXQgIk5vbiBlc3NlbnRpYWwgSHlwZXJ0ZW5zaW9uIFNOT01FRENUIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTAzMi4xMCcNCnZhbHVlc2V0ICJQcmVnbmFuY3kiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzODgzLjMuNTI2LjMuMzc4Jw0KdmFsdWVzZXQgIkVuZCBTdGFnZSBSZW5hbCBEaXNlYXNlIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzg4My4zLjUyNi4yLjU5MCcNCnZhbHVlc2V0ICJIb3NwaWNlIGNhcmUgYW1idWxhdG9yeSI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM3NjIuMS40LjExMDguMTUnDQoNCmNvZGUgImFtYnVsYXRvcnkiOiAnQU1CJyBmcm9tICJ2MyBDb2RlIFN5c3RlbSBBY3RDb2RlIiBkaXNwbGF5ICdhbWJ1bGF0b3J5Jw0KDQovLyBDb25kaXRpb24gQ2xpbmljYWwgU3RhdHVzIENvZGVzIC0gQ29uc2lkZXIgdmFsdWUgc2V0cyBmb3IgdGhlc2UNCmNvZGUgImFjdGl2ZSI6ICdhY3RpdmUnIGZyb20gIkNvbmRpdGlvbkNsaW5pY2FsU3RhdHVzQ29kZXMiDQpjb2RlICJyZWN1cnJlbmNlIjogJ3JlY3VycmVuY2UnIGZyb20gIkNvbmRpdGlvbkNsaW5pY2FsU3RhdHVzQ29kZXMiDQpjb2RlICJyZWxhcHNlIjogJ3JlbGFwc2UnIGZyb20gIkNvbmRpdGlvbkNsaW5pY2FsU3RhdHVzQ29kZXMiDQpjb2RlICJpbmFjdGl2ZSI6ICdpbmFjdGl2ZScgZnJvbSAiQ29uZGl0aW9uQ2xpbmljYWxTdGF0dXNDb2RlcyINCmNvZGUgInJlbWlzc2lvbiI6ICdyZW1pc3Npb24nIGZyb20gIkNvbmRpdGlvbkNsaW5pY2FsU3RhdHVzQ29kZXMiDQpjb2RlICJyZXNvbHZlZCI6ICdyZXNvbHZlZCcgZnJvbSAiQ29uZGl0aW9uQ2xpbmljYWxTdGF0dXNDb2RlcyINCg0KLy8gQ29uZGl0aW9uIFZlcmlmaWNhdGlvbiBTdGF0dXMgQ29kZXMgLSBDb25zaWRlciB2YWx1ZSBzZXRzIGZvciB0aGVzZQ0KY29kZSAidW5jb25maXJtZWQiOiAndW5jb25maXJtZWQnIGZyb20gQ29uZGl0aW9uVmVyaWZpY2F0aW9uU3RhdHVzQ29kZXMNCmNvZGUgInByb3Zpc2lvbmFsIjogJ3Byb3Zpc2lvbmFsJyBmcm9tIENvbmRpdGlvblZlcmlmaWNhdGlvblN0YXR1c0NvZGVzDQpjb2RlICJkaWZmZXJlbnRpYWwiOiAnZGlmZmVyZW50aWFsJyBmcm9tIENvbmRpdGlvblZlcmlmaWNhdGlvblN0YXR1c0NvZGVzDQpjb2RlICJjb25maXJtZWQiOiAnY29uZmlybWVkJyBmcm9tIENvbmRpdGlvblZlcmlmaWNhdGlvblN0YXR1c0NvZGVzDQpjb2RlICJyZWZ1dGVkIjogJ3JlZnV0ZWQnIGZyb20gQ29uZGl0aW9uVmVyaWZpY2F0aW9uU3RhdHVzQ29kZXMNCmNvZGUgImVudGVyZWQtaW4tZXJyb3IiOiAnZW50ZXJlZC1pbi1lcnJvcicgZnJvbSBDb25kaXRpb25WZXJpZmljYXRpb25TdGF0dXNDb2Rlcw0KDQpjb2RlICJwcm9ibGVtLWxpc3QtaXRlbSI6ICdwcm9ibGVtLWxpc3QtaXRlbScgZnJvbSAiQ29uZGl0aW9uQ2F0ZWdvcnlTeXN0ZW0iIGRpc3BsYXkgJ1Byb2JsZW0gTGlzdCBJdGVtJw0KY29kZSAiZW5jb3VudGVyLWRpYWdub3NpcyI6ICdlbmNvdW50ZXItZGlhZ25vc2lzJyBmcm9tICJDb25kaXRpb25DYXRlZ29yeVN5c3RlbSIgZGlzcGxheSAnRW5jb3VudGVyIERpYWdub3NpcycNCg0KY29kZSAiaG9tZS1tZWFzdXJlbWVudCI6ICcyNjQzNjIwMDMnIGZyb20gIlNOT01FRCINCg0KY29kZSAiQWN0aXZlIE1lZGljYXRpb24gUmVxdWVzdCI6ICdhY3RpdmUnIGZyb20gIk1lZGljYXRpb24gcmVxdWVzdCBzdGF0dXMiDQoNCmNvbnRleHQgUGF0aWVudA0KDQpkZWZpbmUgZnVuY3Rpb24gIkF2ZyBTeXN0b2xpYyBCUCIobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToNCiAgQXZnKGxpc3QgTw0KICAgIHJldHVybiBhbGwgRkhJUkhlbHBlcnMuVG9RdWFudGl0eShzaW5nbGV0b24gZnJvbSAoTy5jb21wb25lbnQgQyB3aGVyZSBDLmNvZGUgaW4gIlN5c3RvbGljIGJsb29kIHByZXNzdXJlIikudmFsdWUpDQogICkNCg0KZGVmaW5lIGZ1bmN0aW9uICJBdmcgRGlhc3RvbGljIEJQIihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOg0KICBBdmcobGlzdCBPDQogICAgcmV0dXJuIGFsbCBGSElSSGVscGVycy5Ub1F1YW50aXR5KHNpbmdsZXRvbiBmcm9tIChPLmNvbXBvbmVudCBDIHdoZXJlIEMuY29kZSBpbiAiRGlhc3RvbGljIEJsb29kIFByZXNzdXJlIikudmFsdWUpDQogICkNCg0KZGVmaW5lIGZ1bmN0aW9uICJBdmcgQlAiKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6DQogIFR1cGxlIHsgc3lzdG9saWM6ICJBdmcgU3lzdG9saWMgQlAiKGxpc3QpLCBkaWFzdG9saWM6ICJBdmcgRGlhc3RvbGljIEJQIihsaXN0KSB9DQoNCmRlZmluZSBmdW5jdGlvbiAiQXZnIEJQIFN0cmluZyIobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToNCiAgKCJBdmcgQlAiKGxpc3QpKSBPDQogICAgcmV0dXJuIFRvU3RyaW5nKFJvdW5kKE8uc3lzdG9saWMudmFsdWUpKSArICcvJyArIFRvU3RyaW5nKFJvdW5kKE8uZGlhc3RvbGljLnZhbHVlKSkgKyAnICcgKyBPLnN5c3RvbGljLnVuaXQNCg0KZGVmaW5lIGZ1bmN0aW9uICJOb3JtYWwgQlAiKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6DQogICgiQXZnIEJQIihsaXN0KSkgTw0KICAgIHdoZXJlIE8uc3lzdG9saWMudmFsdWUgPCAxMzANCiAgICBhbmQgTy5kaWFzdG9saWMudmFsdWUgPCA4MA0KDQpkZWZpbmUgZnVuY3Rpb24gIkVsZXZhdGVkIG9yIEFib3ZlIEJQIihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOg0KICAoIkF2ZyBCUCIobGlzdCkpIE8NCiAgICB3aGVyZSBPLnN5c3RvbGljLnZhbHVlID49IDEzMA0KICAgIG9yIE8uZGlhc3RvbGljLnZhbHVlID49IDgwDQoNCmRlZmluZSBmdW5jdGlvbiAiSFROIFN0YWdlIDEgQlAiKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6DQogICgiQXZnIEJQIihsaXN0KSkgTw0KICAgIHdoZXJlIChPLnN5c3RvbGljLnZhbHVlID49IDEzMCBhbmQgTy5zeXN0b2xpYy52YWx1ZSA8IDE0MCkNCiAgICBvciAoTy5kaWFzdG9saWMudmFsdWUgPj0gODAgYW5kIE8uZGlhc3RvbGljLnZhbHVlIDwgOTApDQoNCmRlZmluZSBmdW5jdGlvbiAiSFROIFN0YWdlIDIgQlAiKGxpc3QgTGlzdDxGSElSLk9ic2VydmF0aW9uPik6DQogICgiQXZnIEJQIihsaXN0KSkgTw0KICAgIHdoZXJlIE8uc3lzdG9saWMudmFsdWUgPj0gMTQwDQogICAgb3IgTy5kaWFzdG9saWMudmFsdWUgPj0gOTANCg0KZGVmaW5lIGZ1bmN0aW9uICJIVE4gU3RhZ2UgMiBCUCBTeXN0b2xpYyBTZWNvbmQgVGVzdCIobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToNCiAgKCJBdmcgQlAiKGxpc3QpKSBPDQogICAgd2hlcmUgTy5zeXN0b2xpYy52YWx1ZSA+PSAxNjANCg0KZGVmaW5lIGZ1bmN0aW9uICJIVE4gQ3Jpc2lzIEJQIihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOg0KICAoIkF2ZyBCUCIobGlzdCkpIE8NCiAgICB3aGVyZSBPLnN5c3RvbGljLnZhbHVlID49IDE4MA0KICAgIG9yIE8uZGlhc3RvbGljLnZhbHVlID49IDEyMA0KDQpkZWZpbmUgZnVuY3Rpb24gIlN5c3RvbGljIEJQIFZhcmlhYmlsaXR5IihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOg0KICBpZiBsaXN0IGlzIG51bGwgdGhlbg0KICAgIG51bGwNCiAgZWxzZSBpZiBDb3VudChsaXN0KSA8PSAxIHRoZW4NCiAgICBudWxsDQogIGVsc2UNCiAgICBTdGREZXYobGlzdCBPDQogICAgICByZXR1cm4gYWxsIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoc2luZ2xldG9uIGZyb20gKE8uY29tcG9uZW50IEMgd2hlcmUgQy5jb2RlIGluICJTeXN0b2xpYyBibG9vZCBwcmVzc3VyZSIpLnZhbHVlKQ0KICApDQoNCmRlZmluZSBmdW5jdGlvbiAiU3lzdG9saWMgQlAgVmFyaWFiaWxpdHkgU3RyaW5nIihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOg0KICAoIlN5c3RvbGljIEJQIFZhcmlhYmlsaXR5IihsaXN0KSkgUw0KICAgIHJldHVybiBUb1N0cmluZyhSb3VuZChTLnZhbHVlLCAxKSkgKyAnICcgKyBTLnVuaXQNCg0KDQovKiBIZWxwZXJzICovDQpkZWZpbmUgZnVuY3Rpb24gV2l0aFVuaXQobGlzdCBMaXN0PE9ic2VydmF0aW9uPiwgVW5pdCBTdHJpbmcpOg0KICBsaXN0IE9ic2VydmF0aW9ucw0KICAgIHdoZXJlICgNCiAgICAgICgoc2luZ2xldG9uIGZyb20gKE9ic2VydmF0aW9ucy5jb21wb25lbnQgQyB3aGVyZSBDLmNvZGUgaW4gIlN5c3RvbGljIGJsb29kIHByZXNzdXJlIikudmFsdWUgYXMgRkhJUi5RdWFudGl0eSkudW5pdC52YWx1ZSB+IFVuaXQNCiAgICAgICAgYW5kIChzaW5nbGV0b24gZnJvbSAoT2JzZXJ2YXRpb25zLmNvbXBvbmVudCBDIHdoZXJlIEMuY29kZSBpbiAiRGlhc3RvbGljIEJsb29kIFByZXNzdXJlIikudmFsdWUgYXMgRkhJUi5RdWFudGl0eSkudW5pdC52YWx1ZSB+IFVuaXQpDQogICAgICBvciAoKHNpbmdsZXRvbiBmcm9tIChPYnNlcnZhdGlvbnMuY29tcG9uZW50IEMgd2hlcmUgQy5jb2RlIGluICJTeXN0b2xpYyBibG9vZCBwcmVzc3VyZSIpLnZhbHVlIGFzIEZISVIuUXVhbnRpdHkpLmNvZGUudmFsdWUgfiBVbml0DQogICAgICAgIGFuZCAoc2luZ2xldG9uIGZyb20gKE9ic2VydmF0aW9ucy5jb21wb25lbnQgQyB3aGVyZSBDLmNvZGUgaW4gIkRpYXN0b2xpYyBCbG9vZCBQcmVzc3VyZSIpLnZhbHVlIGFzIEZISVIuUXVhbnRpdHkpLmNvZGUudmFsdWUgfiBVbml0KQ0KICAgICkNCg0KZGVmaW5lIGZ1bmN0aW9uIFdpdGhVbml0KHZhbHVlIFF1YW50aXR5LCBVbml0IFN0cmluZyk6DQogICgNCiAgICB2YWx1ZSBxdWFudGl0eQ0KICAgIHdoZXJlICgNCiAgICAgIHF1YW50aXR5LmNvZGUudmFsdWUgfiBVbml0DQogICAgICBvciBxdWFudGl0eS51bml0LnZhbHVlIH4gVW5pdA0KICAgICkNCiAgKSBpcyBub3QgbnVsbA0KDQoNCmRlZmluZSBmdW5jdGlvbiBRdWFsaWZpZWRFbmNvdW50ZXIobGlzdCBMaXN0PEZISVIuRW5jb3VudGVyPik6DQogIGxpc3QgRW5jb3VudGVyDQogICAgLy9wbGFubmVkIHwgYXJyaXZlZCB8IHRyaWFnZWQgfCBpbi1wcm9ncmVzcyB8IG9ubGVhdmUgfCBmaW5pc2hlZCB8IGNhbmNlbGxlZCArDQogICAgd2hlcmUgRW5jb3VudGVyLnN0YXR1cyB+ICdmaW5pc2hlZCcNCg0KZGVmaW5lIGZ1bmN0aW9uIFF1YWxpZmllZENvbmRpdGlvbihsaXN0IExpc3Q8RkhJUi5Db25kaXRpb24+KToNCiAgbGlzdCBDb25kaXRpb24NCiAgICAvL2FjdGl2ZSB8IHJlY3VycmVuY2UgfCByZWxhcHNlIHwgaW5hY3RpdmUgfCByZW1pc3Npb24gfCByZXNvbHZlZA0KICAgIC8vd2hlcmUgQWN0aXZlQ29uZGl0aW9uKENvbmRpdGlvbikgaXMgbm90IG51bGwNCiAgICAvL3VuY29uZmlybWVkIHwgcHJvdmlzaW9uYWwgfCBkaWZmZXJlbnRpYWwgfCBjb25maXJtZWQgfCByZWZ1dGVkIHwgZW50ZXJlZC1pbi1lcnJvcg0KICAgIHdoZXJlIENvbmZpcm1lZENvbmRpdGlvbihDb25kaXRpb24pIGlzIG5vdCBudWxsDQoNCmRlZmluZSBmdW5jdGlvbiBRdWFsaWZpZWRPYnNlcnZhdGlvbihsaXN0IExpc3Q8RkhJUi5PYnNlcnZhdGlvbj4pOg0KICBsaXN0IE9ic2VydmF0aW9uDQoJCXdoZXJlICgNCiAgICAgIC8vcmVnaXN0ZXJlZCB8IHByZWxpbWluYXJ5IHwgZmluYWwgfCBhbWVuZGVkIHwgY29ycmVjdGVkIHwgY2FuY2VsbGVkIHwgZW50ZXJlZC1pbi1lcnJvciB8IHVua25vd24NCgkJCU9ic2VydmF0aW9uLnN0YXR1cyB+ICdmaW5hbCcNCgkJCW9yIE9ic2VydmF0aW9uLnN0YXR1cyB+ICdhbWVuZGVkJw0KCQkJb3IgT2JzZXJ2YXRpb24uc3RhdHVzIH4gJ2NvcnJlY3RlZCcNCgkJKQ0KDQpkZWZpbmUgZnVuY3Rpb24gUXVhbGlmaWVkUHJvY2VkdXJlKGxpc3QgTGlzdDxGSElSLlByb2NlZHVyZT4pOg0KICBsaXN0IFByb2NlZHVyZQ0KICAgIC8vcHJlcGFyYXRpb24gfCBpbi1wcm9ncmVzcyB8IG5vdC1kb25lIHwgb24taG9sZCB8IHN0b3BwZWQgfCBjb21wbGV0ZWQgfCBlbnRlcmVkLWluLWVycm9yIHwgdW5rbm93bg0KICAgIHdoZXJlIFByb2NlZHVyZS5zdGF0dXMgfiAnY29tcGxldGVkJw0KDQpkZWZpbmUgZnVuY3Rpb24gQ29uZmlybWVkQ29uZGl0aW9uKGxpc3QgTGlzdDxDb25kaXRpb24+KToNCiAgbGlzdCBDb25kaXRpb24NCiAgICB3aGVyZSBGSElSSGVscGVycy5Ub0NvbmNlcHQoQ29uZGl0aW9uLnZlcmlmaWNhdGlvblN0YXR1cykgfiAiY29uZmlybWVkIg0KDQpkZWZpbmUgZnVuY3Rpb24gQ29uZmlybWVkQ29uZGl0aW9uKHZhbHVlIENvbmRpdGlvbik6DQogIHZhbHVlIENvbmRpdGlvbg0KICAgIHdoZXJlIEZISVJIZWxwZXJzLlRvQ29uY2VwdChDb25kaXRpb24udmVyaWZpY2F0aW9uU3RhdHVzKSB+ICJjb25maXJtZWQiDQoNCmRlZmluZSBmdW5jdGlvbiBBY3RpdmVDb25kaXRpb24obGlzdCBMaXN0PENvbmRpdGlvbj4pOg0KICBsaXN0IENvbmRpdGlvbg0KICAgIHdoZXJlIEZISVJIZWxwZXJzLlRvQ29uY2VwdChDb25kaXRpb24uY2xpbmljYWxTdGF0dXMpIH4gImFjdGl2ZSINCiAgICAgIGFuZCBDb25kaXRpb24uYWJhdGVtZW50IGlzIG51bGwNCg0KZGVmaW5lIGZ1bmN0aW9uIEFjdGl2ZUNvbmRpdGlvbih2YWx1ZSBDb25kaXRpb24pOg0KICB2YWx1ZSBDb25kaXRpb24NCiAgICB3aGVyZSBGSElSSGVscGVycy5Ub0NvbmNlcHQoQ29uZGl0aW9uLmNsaW5pY2FsU3RhdHVzKSB+ICJhY3RpdmUiDQogICAgICBhbmQgQ29uZGl0aW9uLmFiYXRlbWVudCBpcyBudWxsDQoNCmRlZmluZSBmdW5jdGlvbiBBY3RpdmVPclJlY3VycmluZyhsaXN0IExpc3Q8Q29uZGl0aW9uPik6DQogIGxpc3QgQ29uZGl0aW9uDQogICAgd2hlcmUgKA0KICAgICAgRkhJUkhlbHBlcnMuVG9Db25jZXB0KENvbmRpdGlvbi5jbGluaWNhbFN0YXR1cykgfiAiYWN0aXZlIg0KICAgICAgICBhbmQgQ29uZGl0aW9uLmFiYXRlbWVudCBpcyBudWxsDQogICAgICApDQogICAgICBvciBGSElSSGVscGVycy5Ub0NvbmNlcHQoQ29uZGl0aW9uLmNsaW5pY2FsU3RhdHVzKSB+ICJyZWxhcHNlIg0KDQovLyBFcGljIHNvbWV0aW1lcyBwcm92aWRlcyB0aGUgb2lkIGluc3RlYWQgb2YgdGhlIG5hbWVkIHN5c3RlbSwgYnV0IHdlIG5lZWQgdGhlIG5hbWVkIHN5c3RlbSBmb3IgY29tcGFyaW5nIHRvIFZhbHVlU2V0cw0KZGVmaW5lIGZ1bmN0aW9uIEZpeEVwaWNTeXN0ZW1NYXBwaW5nKHN5c3RlbSBTdHJpbmcpOg0KICBpZiBNYXRjaGVzKHN5c3RlbSwgJ3VybjpvaWQ6Mi4xNi44NDAuMS4xMTM4ODMuNi45NicpIHRoZW4gJ2h0dHA6Ly9zbm9tZWQuaW5mby9zY3QnDQogIGVsc2UgaWYgTWF0Y2hlcyhzeXN0ZW0sICd1cm46b2lkOjIuMTYuODQwLjEuMTEzODgzLjYuOTAnKSB0aGVuICdodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAtY20nDQogIGVsc2Ugc3lzdGVtDQoNCi8vIFRha2UgdGhlIGxpc3Qgb2YgQ29kZXMgYW5kIHJlcGxhY2UgdGhlIHN5c3RlbXMgd2hlbiBuZWVkZWQNCmRlZmluZSBmdW5jdGlvbiBUcmFuZm9ybUNvZGVMaXN0KGxpc3QgTGlzdDxTeXN0ZW0uQ29kZT4pOg0KICBsaXN0IGNvZGluZw0KICByZXR1cm4gU3lzdGVtLkNvZGUgew0KICAgIGNvZGU6IGNvZGluZy5jb2RlLA0KICAgIHN5c3RlbTogRml4RXBpY1N5c3RlbU1hcHBpbmcoY29kaW5nLnN5c3RlbSksDQogICAgdmVyc2lvbjogY29kaW5nLnZlcnNpb24sDQogICAgZGlzcGxheTogY29kaW5nLmRpc3BsYXkNCiAgfQ0KDQovLyBUcmFuc2Zvcm0gdGhlIGNvZGVzIGluIHRoZSBDb2RlYWJsZUNvbmNlcHQsIHJlcGxhY2luZyB0aGUgc3lzdGVtcyB3aGVuIG5lZWRlZA0KZGVmaW5lIGZ1bmN0aW9uIFRyYW5zZm9ybUNvZGVhYmxlQ29uY2VwdChjYyBGSElSLkNvZGVhYmxlQ29uY2VwdCk6DQogIFRyYW5mb3JtQ29kZUxpc3QoRkhJUkhlbHBlcnMuVG9Db25jZXB0KGNjKS5jb2RlcykNCg0KZGVmaW5lIGZ1bmN0aW9uIFF1YWxpZmllZEdvYWwobGlzdCBMaXN0PEdvYWw+KToNCiAgbGlzdCBHb2FsDQogICAgLy9wcm9wb3NlZCB8IHBsYW5uZWQgfCBhY2NlcHRlZCB8IGFjdGl2ZSB8IG9uLWhvbGQgfCBjb21wbGV0ZWQgfCBjYW5jZWxsZWQgfCBlbnRlcmVkLWluLWVycm9yIHwgcmVqZWN0ZWQNCiAgICB3aGVyZSAoDQogICAgICBHb2FsLmxpZmVjeWNsZVN0YXR1cyB+ICdwcm9wb3NlZCcNCiAgICAgIG9yIEdvYWwubGlmZWN5Y2xlU3RhdHVzIH4gJ3BsYW5uZWQnDQogICAgICBvciBHb2FsLmxpZmVjeWNsZVN0YXR1cyB+ICdhY2NlcHRlZCcNCiAgICAgIG9yIEdvYWwubGlmZWN5Y2xlU3RhdHVzIH4gJ2FjdGl2ZScNCiAgICAgIG9yIEdvYWwubGlmZWN5Y2xlU3RhdHVzIH4gJ2NvbXBsZXRlZCcNCiAgICApDQoNCg0KZGVmaW5lIGZ1bmN0aW9uICJHZXRJZCIodXJpIFN0cmluZyk6DQoJTGFzdChTcGxpdCh1cmksICcvJykpDQoNCi8qDQpAZGVzY3JpcHRpb246IE5vcm1hbGl6ZXMgYSB2YWx1ZSB0aGF0IGlzIGEgY2hvaWNlIG9mIHRpbWluZy12YWx1ZWQgdHlwZXMgdG8gYW4gZXF1aXZhbGVudCBpbnRlcnZhbA0KQGNvbW1lbnQ6IE5vcm1hbGl6ZXMgYSBjaG9pY2UgdHlwZSBvZiBGSElSLmRhdGVUaW1lLCBGSElSLlBlcmlvZCwgRkhJUi5UaW1pbmcsIEZISVIuaW5zdGFuY2UsIEZISVIuc3RyaW5nLCBGSElSLkFnZSwgb3IgRkhJUi5SYW5nZSB0eXBlcw0KdG8gYW4gZXF1aXZhbGVudCBpbnRlcnZhbC4gVGhpcyBzZWxlY3Rpb24gb2YgY2hvaWNlIHR5cGVzIGlzIGEgc3VwZXJzZXQgb2YgdGhlIG1ham9yaXR5IG9mIGNob2ljZSB0eXBlcyB0aGF0IGFyZSB1c2VkIGFzIHBvc3NpYmxlDQpyZXByZXNlbnRhdGlvbnMgZm9yIHRpbWluZy12YWx1ZWQgZWxlbWVudHMgaW4gRkhJUiwgYWxsb3dpbmcgdGhpcyBmdW5jdGlvbiB0byBiZSB1c2VkIGFjcm9zcyBhbnkgcmVzb3VyY2UuIE5PVEU6IER1ZSB0byB0aGUNCmNvbXBsZXhpdHkgb2YgZGV0ZXJtaW5pbmcgYSBzaW5nbGUgaW50ZXJ2YWwgZnJvbSBhIFRpbWluZyBvciBTdHJpbmcgdHlwZSwgdGhpcyBmdW5jdGlvbiB3aWxsIHRocm93IGEgcnVuLXRpbWUgZXhjZXB0aW9uIGlmIGl0IGlzIHVzZWQNCndpdGggYSBUaW1pbmcgb3IgU3RyaW5nLg0KKi8NCmRlZmluZSBmdW5jdGlvbiAiTm9ybWFsaXplIEludGVydmFsIihjaG9pY2UgQ2hvaWNlPEZISVIuZGF0ZVRpbWUsIEZISVIuUGVyaW9kLCBGSElSLlRpbWluZywgRkhJUi5pbnN0YW50LCBGSElSLnN0cmluZywgRkhJUi5BZ2UsIEZISVIuUmFuZ2U+KToNCiAgY2FzZQ0KCSAgd2hlbiBjaG9pY2UgaXMgRkhJUi5kYXRlVGltZSB0aGVuDQogICAgCUludGVydmFsW0ZISVJIZWxwZXJzLlRvRGF0ZVRpbWUoY2hvaWNlIGFzIEZISVIuZGF0ZVRpbWUpLCBGSElSSGVscGVycy5Ub0RhdGVUaW1lKGNob2ljZSBhcyBGSElSLmRhdGVUaW1lKV0NCgkJd2hlbiBjaG9pY2UgaXMgRkhJUi5QZXJpb2QgdGhlbg0KICAJCUZISVJIZWxwZXJzLlRvSW50ZXJ2YWwoY2hvaWNlIGFzIEZISVIuUGVyaW9kKQ0KCQl3aGVuIGNob2ljZSBpcyBGSElSLmluc3RhbnQgdGhlbg0KCQkJSW50ZXJ2YWxbRkhJUkhlbHBlcnMuVG9EYXRlVGltZShjaG9pY2UgYXMgRkhJUi5pbnN0YW50KSwgRkhJUkhlbHBlcnMuVG9EYXRlVGltZShjaG9pY2UgYXMgRkhJUi5pbnN0YW50KV0NCgkJd2hlbiBjaG9pY2UgaXMgRkhJUi5BZ2UgdGhlbg0KCQkgIEludGVydmFsW0ZISVJIZWxwZXJzLlRvRGF0ZShQYXRpZW50LmJpcnRoRGF0ZSkgKyBGSElSSGVscGVycy5Ub1F1YW50aXR5KGNob2ljZSBhcyBGSElSLkFnZSksDQoJCQkgIEZISVJIZWxwZXJzLlRvRGF0ZShQYXRpZW50LmJpcnRoRGF0ZSkgKyBGSElSSGVscGVycy5Ub1F1YW50aXR5KGNob2ljZSBhcyBGSElSLkFnZSkgKyAxIHllYXIpDQoJCXdoZW4gY2hvaWNlIGlzIEZISVIuUmFuZ2UgdGhlbg0KCQkgIEludGVydmFsW0ZISVJIZWxwZXJzLlRvRGF0ZShQYXRpZW50LmJpcnRoRGF0ZSkgKyBGSElSSGVscGVycy5Ub1F1YW50aXR5KChjaG9pY2UgYXMgRkhJUi5SYW5nZSkubG93KSwNCgkJCSAgRkhJUkhlbHBlcnMuVG9EYXRlKFBhdGllbnQuYmlydGhEYXRlKSArIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoKGNob2ljZSBhcyBGSElSLlJhbmdlKS5oaWdoKSArIDEgeWVhcikNCgkJd2hlbiBjaG9pY2UgaXMgRkhJUi5UaW1pbmcgdGhlbg0KCQkgIE1lc3NhZ2UobnVsbCBhcyBJbnRlcnZhbDxEYXRlVGltZT4sIHRydWUsICcxJywgJ0Vycm9yJywgJ0Nhbm5vdCBjb21wdXRlIGEgc2luZ2xlIGludGVydmFsIGZyb20gYSBUaW1pbmcgdHlwZScpDQogICAgd2hlbiBjaG9pY2UgaXMgRkhJUi5zdHJpbmcgdGhlbg0KICAgICAgTWVzc2FnZShudWxsIGFzIEludGVydmFsPERhdGVUaW1lPiwgdHJ1ZSwgJzEnLCAnRXJyb3InLCAnQ2Fubm90IGNvbXB1dGUgYW4gaW50ZXJ2YWwgZnJvbSBhIFN0cmluZyB2YWx1ZScpDQoJCWVsc2UNCgkJCW51bGwgYXMgSW50ZXJ2YWw8RGF0ZVRpbWU+DQoJZW5kDQoNCi8qDQpAZGVzY3JpcHRpb246IFJldHVybnMgYW4gaW50ZXJ2YWwgcmVwcmVzZW50aW5nIHRoZSBub3JtYWxpemVkIEFiYXRlbWVudCBvZiBhIGdpdmVuIENvbmRpdGlvbiByZXNvdXJjZS4NCkBjb21tZW50OiBOT1RFOiBEdWUgdG8gdGhlIGNvbXBsZXhpdHkgb2YgZGV0ZXJtaW5pbmcgYW4gaW50ZXJ2YWwgZnJvbSBhIFN0cmluZywgdGhpcyBmdW5jdGlvbiB3aWxsIHRocm93DQphIHJ1bi10aW1lIGV4Y2VwdGlvbiBpZiB1c2VkIHdpdGggYSBDb25kaXRpb24gaW5zdGFuY2UgdGhhdCBoYXMgYSBTdHJpbmcgYXMgdGhlIGFiYXRlbWVudCB2YWx1ZS4NCiovDQpkZWZpbmUgZnVuY3Rpb24gIk5vcm1hbGl6ZSBBYmF0ZW1lbnQiKGNvbmRpdGlvbiBDb25kaXRpb24pOg0KICBpZiBjb25kaXRpb24uYWJhdGVtZW50IGlzIEZISVIuZGF0ZVRpbWUgdGhlbg0KICAgIEludGVydmFsW0ZISVJIZWxwZXJzLlRvRGF0ZVRpbWUoY29uZGl0aW9uLmFiYXRlbWVudCBhcyBGSElSLmRhdGVUaW1lKSwgRkhJUkhlbHBlcnMuVG9EYXRlVGltZShjb25kaXRpb24uYWJhdGVtZW50IGFzIEZISVIuZGF0ZVRpbWUpXQ0KICBlbHNlIGlmIGNvbmRpdGlvbi5hYmF0ZW1lbnQgaXMgRkhJUi5QZXJpb2QgdGhlbg0KICAgIEZISVJIZWxwZXJzLlRvSW50ZXJ2YWwoY29uZGl0aW9uLmFiYXRlbWVudCBhcyBGSElSLlBlcmlvZCkNCiAgZWxzZSBpZiBjb25kaXRpb24uYWJhdGVtZW50IGlzIEZISVIuc3RyaW5nIHRoZW4NCiAgICBNZXNzYWdlKG51bGwgYXMgSW50ZXJ2YWw8RGF0ZVRpbWU+LCB0cnVlLCAnMScsICdFcnJvcicsICdDYW5ub3QgY29tcHV0ZSBhbiBpbnRlcnZhbCBmcm9tIGEgU3RyaW5nIHZhbHVlJykNCiAgZWxzZSBpZiBjb25kaXRpb24uYWJhdGVtZW50IGlzIEZISVIuQWdlIHRoZW4NCiAgICBJbnRlcnZhbFtGSElSSGVscGVycy5Ub0RhdGUoUGF0aWVudC5iaXJ0aERhdGUpICsgRkhJUkhlbHBlcnMuVG9RdWFudGl0eShjb25kaXRpb24uYWJhdGVtZW50IGFzIEZISVIuQWdlKSwNCiAgICAgIEZISVJIZWxwZXJzLlRvRGF0ZShQYXRpZW50LmJpcnRoRGF0ZSkgKyBGSElSSGVscGVycy5Ub1F1YW50aXR5KGNvbmRpdGlvbi5hYmF0ZW1lbnQgYXMgRkhJUi5BZ2UpICsgMSB5ZWFyKQ0KICBlbHNlIGlmIGNvbmRpdGlvbi5hYmF0ZW1lbnQgaXMgRkhJUi5SYW5nZSB0aGVuDQogICAgSW50ZXJ2YWxbRkhJUkhlbHBlcnMuVG9EYXRlKFBhdGllbnQuYmlydGhEYXRlKSArIEZISVJIZWxwZXJzLlRvUXVhbnRpdHkoKGNvbmRpdGlvbi5hYmF0ZW1lbnQgYXMgRkhJUi5SYW5nZSkubG93KSwNCiAgICAgIEZISVJIZWxwZXJzLlRvRGF0ZShQYXRpZW50LmJpcnRoRGF0ZSkgKyBGSElSSGVscGVycy5Ub1F1YW50aXR5KChjb25kaXRpb24uYWJhdGVtZW50IGFzIEZISVIuUmFuZ2UpLmhpZ2gpICsgMSB5ZWFyKQ0KICBlbHNlIGlmIGNvbmRpdGlvbi5hYmF0ZW1lbnQgaXMgRkhJUi5ib29sZWFuIHRoZW4NCiAgICBJbnRlcnZhbFtlbmQgb2YgIk5vcm1hbGl6ZSBJbnRlcnZhbCIoY29uZGl0aW9uLm9uc2V0KSwgY29uZGl0aW9uLnJlY29yZGVkRGF0ZSkNCiAgZWxzZSBudWxsDQoNCi8qDQpAZGVzY3JpcHRpb246IFJldHVybnMgYW4gaW50ZXJ2YWwgcmVwcmVzZW50aW5nIHRoZSBub3JtYWxpemVkIHByZXZhbGVuY2UgcGVyaW9kIG9mIGEgZ2l2ZW4gQ29uZGl0aW9uIHJlc291cmNlLg0KKi8NCmRlZmluZSBmdW5jdGlvbiAiUHJldmFsZW5jZSBQZXJpb2QiKGNvbmRpdGlvbiBDb25kaXRpb24pOg0KICBpZiBjb25kaXRpb24uY2xpbmljYWxTdGF0dXMgfiAiYWN0aXZlIg0KICAgIG9yIGNvbmRpdGlvbi5jbGluaWNhbFN0YXR1cyB+ICJyZWN1cnJlbmNlIg0KICAgIG9yIGNvbmRpdGlvbi5jbGluaWNhbFN0YXR1cyB+ICJyZWxhcHNlIg0KICAgIC8vIFRoaXMgcHJldmVudHMgZXJyb3JzIHdoZW4gYSBjb25kaXRpb24gaGFzIGFuIG9uc2V0IGFuZCBhYmF0ZW1lbnQgb24gdGhlIHNhbWUgZGF5IGFuZCBubyB0aW1lc3RhbXAgaXMgcHJvdmlkZWQgKEVwaWMpDQogICAgb3IgZW5kIG9mICJOb3JtYWxpemUgQWJhdGVtZW50Iihjb25kaXRpb24pIGlzIG5vdCBudWxsIHRoZW4NCiAgICBJbnRlcnZhbFtzdGFydCBvZiAiTm9ybWFsaXplIEludGVydmFsIihjb25kaXRpb24ub25zZXQpLCBlbmQgb2YgIk5vcm1hbGl6ZSBBYmF0ZW1lbnQiKGNvbmRpdGlvbildDQogIGVsc2UNCiAgICAvLyBUaGUgY29uZGl0aW9uIGlzIG5vdCBhY3RpdmUgYnV0IGhhcyBubyBhYmF0ZW1lbnQgZGF0ZSwgc28gd2UgY2FuJ3Qgc2F5IHdoZW4gaXQgZW5kZWQNCiAgICBJbnRlcnZhbFtzdGFydCBvZiAiTm9ybWFsaXplIEludGVydmFsIihjb25kaXRpb24ub25zZXQpLCBudWxsKQ0KDQovKioqKiogQ29tbW9uIERhdGEgKioqKiovDQoNCi8qIFBvdGVudGlhbCBFeGNsdXNpb24gQ3JpdGVyaWEgKi8NCmRlZmluZSAiUGF0aWVudCBVbmRlciBBZ2UgMTgiOg0KICBBZ2VJblllYXJzQXQoVG9kYXkoKSkgPCAxOA0KDQpkZWZpbmUgIlBhdGllbnQgT3ZlciBBZ2UgODAiOg0KICBBZ2VJblllYXJzQXQoVG9kYXkoKSkgPiA4MA0KDQovLyBHcmFiIGFsbCBjb25kaXRpb25zIGZvciBwYXRpZW50cyBzaW5jZSB3ZSBjYW4ndCBsaW1pdCBieSBjb2RlIGluIEVwaWMuDQpkZWZpbmUgIkNvbmRpdGlvbnMiOg0KICAoUXVhbGlmaWVkQ29uZGl0aW9uKFsiQ29uZGl0aW9uIjogY2F0ZWdvcnkgfiAicHJvYmxlbS1saXN0LWl0ZW0iXSkpIHVuaW9uDQogIChRdWFsaWZpZWRDb25kaXRpb24oWyJDb25kaXRpb24iOiBjYXRlZ29yeSB+ICJlbmNvdW50ZXItZGlhZ25vc2lzIl0pKQ0KDQpkZWZpbmUgIkNvbmRpdGlvbiBJbmRpY2F0aW5nIEVuZCBTdGFnZSBSZW5hbCBEaXNlYXNlIjoNCiAgIkNvbmRpdGlvbnMiIFByb2JsZW0NCiAgICB3aGVyZSBUcmFuc2Zvcm1Db2RlYWJsZUNvbmNlcHQoUHJvYmxlbS5jb2RlKSBpbiAiRW5kIFN0YWdlIFJlbmFsIERpc2Vhc2UiIGFuZCBlbmQgb2YgIlByZXZhbGVuY2UgUGVyaW9kIihQcm9ibGVtKSA+PSBUb2RheSgpDQoNCmRlZmluZSAiQ29uZGl0aW9uIEluZGljYXRpbmcgUHJlZ25hbmN5IjoNCiAgIkNvbmRpdGlvbnMiIFByb2JsZW0NCiAgICB3aGVyZSBUcmFuc2Zvcm1Db2RlYWJsZUNvbmNlcHQoUHJvYmxlbS5jb2RlKSBpbiAiUHJlZ25hbmN5IiBhbmQgZW5kIG9mICJQcmV2YWxlbmNlIFBlcmlvZCIoUHJvYmxlbSkgPj0gVG9kYXkoKQ0KDQpkZWZpbmUgIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyI6DQogIChXaXRoVW5pdChRdWFsaWZpZWRPYnNlcnZhdGlvbihbIk9ic2VydmF0aW9uIjogIkJsb29kIFByZXNzdXJlIE1lYXN1cmVkIl0pLCAnbW1bSGddJykpIE8NCiAgICAgIHNvcnQgYnkgQ29hbGVzY2Uoc3RhcnQgb2YgIk5vcm1hbGl6ZSBJbnRlcnZhbCIoZWZmZWN0aXZlKSwgaXNzdWVkKQ0KDQpkZWZpbmUgIk1vc3QgUmVjZW50IEJQIFJlYWRpbmciOg0KICBMYXN0KCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMiIE8gc29ydCBieSBDb2FsZXNjZShzdGFydCBvZiAiTm9ybWFsaXplIEludGVydmFsIihlZmZlY3RpdmUpLCBpc3N1ZWQpKQ0KDQpkZWZpbmUgIkJQIFdpdGhpbiAxNCBkYXlzIjoNCiAgIk1vc3QgUmVjZW50IEJQIFJlYWRpbmciIEJQDQogIHJldHVybiBDb2FsZXNjZShzdGFydCBvZiAiTm9ybWFsaXplIEludGVydmFsIihCUC5lZmZlY3RpdmUpLCBCUC5pc3N1ZWQpICsgMTQgZGF5cyA+PSBUb2RheSgpDQoNCmRlZmluZSAiSFROIENyaXNpcyI6DQogICJCUCBXaXRoaW4gMTQgZGF5cyIgYW5kICJIVE4gQ3Jpc2lzIEJQIih7ICJNb3N0IFJlY2VudCBCUCBSZWFkaW5nIiB9KSBpcyBub3QgbnVsbA0KDQpkZWZpbmUgIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIjoNCiAgIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyIgQlAgd2hlcmUgIk5vcm1hbGl6ZSBJbnRlcnZhbCIoQlAuZWZmZWN0aXZlKSBzdGFydHMgMjQgbW9udGhzIG9yIGxlc3MgYmVmb3JlIFRvZGF5KCkNCiAgICBzb3J0IGJ5IENvYWxlc2NlKHN0YXJ0IG9mICJOb3JtYWxpemUgSW50ZXJ2YWwiKGVmZmVjdGl2ZSksIGlzc3VlZCkNCg0KZGVmaW5lICJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIjoNCiAgIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIiBPIHNvcnQgYnkgQ29hbGVzY2Uoc3RhcnQgb2YgIk5vcm1hbGl6ZSBJbnRlcnZhbCIoZWZmZWN0aXZlKSwgaXNzdWVkKSBkZXNjDQoNCmRlZmluZSBmdW5jdGlvbiBNZWFzdXJlbWVudFNldHRpbmdzKGxpc3QgTGlzdDxFeHRlbnNpb24+KToNCiAgbGlzdCBFeHRlbnNpb24NCiAgICB3aGVyZSBFeHRlbnNpb24udXJsID0gJ2h0dHA6Ly9obDcub3JnL2ZoaXIvdXMvdml0YWxzL1N0cnVjdHVyZURlZmluaXRpb24vTWVhc3VyZW1lbnRTZXR0aW5nRXh0Jw0KICByZXR1cm4gRkhJUkhlbHBlcnMuVG9Db2RlKEV4dGVuc2lvbi52YWx1ZSkNCg0KZGVmaW5lICJIb21lIEJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyI6DQogICJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyIgQlBPYnNlcnZhdGlvbg0KICAgIHdoZXJlICJNZWFzdXJlbWVudFNldHRpbmdzIihCUE9ic2VydmF0aW9uLmV4dGVuc2lvbikgY29udGFpbnMgImhvbWUtbWVhc3VyZW1lbnQiDQoNCmRlZmluZSAiT2ZmaWNlIEJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyI6DQogICJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyIgZXhjZXB0ICJIb21lIEJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyINCg0KLy8gUmV2aXNpdCBsb2dpYyB3aGVuIHJlYWR5IHRvIGFkZHJlc3MgYW1idWxhdG9yeSBvYnNlcnZhdGlvbnMuIENoZWNrIG91dCBjb21taXQgNTcwNDY0NDhhMjRkMjRhNzY3ZDQwMmU1ZmE4YTk2Nzc5YTQ4OGYwMiBmb3Igb2xkIGxvZ2ljDQpkZWZpbmUgIkFtYnVsYXRvcnkgQmxvb2QgUHJlc3N1cmUgTW9uaXRvcmluZyBPYnNlcnZhdGlvbnMiOg0KICB7fQ0KDQpkZWZpbmUgIkhhcyBCUCBTZXQiOg0KICAgIGlmIG5vdCBleGlzdHMgIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIiB0aGVuIGZhbHNlDQogICAgZWxzZSBjYWxjdWxhdGVTY29yZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMiKSA+PSA0DQoNCmRlZmluZSBmdW5jdGlvbiBzY29yZShvYnNlcnZhdGlvbiBPYnNlcnZhdGlvbik6DQogIGlmIG9ic2VydmF0aW9uIGluICJBbWJ1bGF0b3J5IEJsb29kIFByZXNzdXJlIE1vbml0b3JpbmcgT2JzZXJ2YXRpb25zIiB0aGVuIDAuMzMzDQogIGVsc2UgaWYgb2JzZXJ2YXRpb24gaW4gIkhvbWUgQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIiB0aGVuIDAuNjY3DQogIGVsc2UgMQ0KDQpkZWZpbmUgZnVuY3Rpb24gY2FsY3VsYXRlU2NvcmUobGlzdCBMaXN0PEZISVIuT2JzZXJ2YXRpb24+KToNCiAgU3VtKGxpc3QgTw0KICAgIHJldHVybiBhbGwgc2NvcmUoTykNCiAgKQ0KDQpkZWZpbmUgIk1vc3QgUmVjZW50IEJQIFNldCI6DQogIGlmIG5vdCAiSGFzIEJQIFNldCIgdGhlbiBudWxsDQogIGVsc2UgaWYgY2FsY3VsYXRlU2NvcmUoVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDQpKSA+PSA0IHRoZW4gVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDQpDQogIGVsc2UgaWYgY2FsY3VsYXRlU2NvcmUoVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDUpKSA+PSA0IHRoZW4gVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDUpDQogIGVsc2UgaWYgY2FsY3VsYXRlU2NvcmUoVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDYpKSA+PSA0IHRoZW4gVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDYpDQogIGVsc2UgaWYgY2FsY3VsYXRlU2NvcmUoVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDcpKSA+PSA0IHRoZW4gVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDcpDQogIGVsc2UgaWYgY2FsY3VsYXRlU2NvcmUoVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDgpKSA+PSA0IHRoZW4gVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDgpDQogIGVsc2UgaWYgY2FsY3VsYXRlU2NvcmUoVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDkpKSA+PSA0IHRoZW4gVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDkpDQogIGVsc2UgaWYgY2FsY3VsYXRlU2NvcmUoVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDEwKSkgPj0gNCB0aGVuIFRha2UoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIERlc2NlbmRpbmciLCAxMCkNCiAgZWxzZSBpZiBjYWxjdWxhdGVTY29yZShUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgMTEpKSA+PSA0IHRoZW4gVGFrZSgiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMgRGVzY2VuZGluZyIsIDExKQ0KICBlbHNlIGlmIGNhbGN1bGF0ZVNjb3JlKFRha2UoIkJsb29kIFByZXNzdXJlIE9ic2VydmF0aW9ucyBmb3IgTGFzdCAyIFllYXJzIERlc2NlbmRpbmciLCAxMikpID49IDQgdGhlbiBUYWtlKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyBEZXNjZW5kaW5nIiwgMTIpDQogIGVsc2UgbnVsbA0KDQpkZWZpbmUgIkF2ZXJhZ2UgQWxsIEJQIExhc3QgMiBZZWFycyI6DQogICJBdmcgQlAiKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyIpDQoNCmRlZmluZSAiQXZlcmFnZSBNb3N0IFJlY2VudCBCUCBTZXQiOg0KICAiQXZnIEJQIigiTW9zdCBSZWNlbnQgQlAgU2V0IikNCg0KLy8gSXMgbGFzdCBCUCBzZXQgb3IgYWxsIEJQcyBhdmdlID4gMTMwLzgwPw0KZGVmaW5lICJQYXRpZW50IEhhcyBQb3RlbnRpYWwgSFROIFN0YWdlIDEgQlAiOg0KICAoDQogICAgIkhUTiBTdGFnZSAxIEJQIigiTW9zdCBSZWNlbnQgQlAgU2V0IikgaXMgbm90IG51bGwNCiAgICBvciAiSFROIFN0YWdlIDEgQlAiKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyIpIGlzIG5vdCBudWxsDQogICkNCg0KLy8gSXMgbGFzdCBCUCBzZXQgb3IgYWxsIEJQcyBhdmVyYWdlID4gMTQwIFNCUCBvciA+IDkwIERCUD8NCmRlZmluZSAiUGF0aWVudCBIYXMgUG90ZW50aWFsIEhUTiBTdGFnZSAyIEJQIjoNCiAgKA0KICAgICJIVE4gU3RhZ2UgMiBCUCIoIk1vc3QgUmVjZW50IEJQIFNldCIpIGlzIG5vdCBudWxsDQogICAgb3IgIkhUTiBTdGFnZSAyIEJQIigiQmxvb2QgUHJlc3N1cmUgT2JzZXJ2YXRpb25zIGZvciBMYXN0IDIgWWVhcnMiKSBpcyBub3QgbnVsbA0KICApDQoNCi8vIElzIFNCUCBDb2VmZiBvZiBWYXIgPiAxMSBmb3IgYWxsIEJQcyBhbmQgbm8gQUJQTT8NCmRlZmluZSAiQlAgSGlnaGx5IFZhcmlhYmxlIjoNCiAgaWYgIkhhcyBCUCBTZXQiIHRoZW4NCiAgICAoDQogICAgICAiU3lzdG9saWMgQlAgVmFyaWFiaWxpdHkiKCJCbG9vZCBQcmVzc3VyZSBPYnNlcnZhdGlvbnMgZm9yIExhc3QgMiBZZWFycyIpLnZhbHVlID4gMTENCiAgICAgIC8vIFRoaXMgbG9naWMgd2FzIHJlbW92ZWQNCiAgICAgIC8vYW5kIG5vdCBleGlzdHMgIkFtYnVsYXRvcnkgQmxvb2QgUHJlc3N1cmUgTW9uaXRvcmluZyBQcm9jZWR1cmVzIg0KICAgICkNCiAgZWxzZSBudWxsDQoNCmRlZmluZSAiQ29uZGl0aW9uIEluZGljYXRpbmcgUHJlZXhpc3RpbmcgSHlwZXJ0ZW5zaW9uIjoNCiAgIkNvbmRpdGlvbnMiIFByb2JsZW0NCiAgICB3aGVyZSAoVHJhbnNmb3JtQ29kZWFibGVDb25jZXB0KFByb2JsZW0uY29kZSkgaW4gIkh5cGVydGVuc2lvbiIgb3IgVHJhbnNmb3JtQ29kZWFibGVDb25jZXB0KFByb2JsZW0uY29kZSkgaW4gIk5vbiBlc3NlbnRpYWwgSHlwZXJ0ZW5zaW9uIFNOT01FRENUIikgYW5kIGVuZCBvZiAiUHJldmFsZW5jZSBQZXJpb2QiKFByb2JsZW0pID49IFRvZGF5KCkNCg0KLy8gRG9lcyBwYXRpZW50IGhhdmUgYSBCUCBnb2FsPw0KZGVmaW5lICJRdWFsaWZ5aW5nIEJsb29kIFByZXNzdXJlIEdvYWxzIjoNCiAgKFF1YWxpZmllZEdvYWwoWyJHb2FsIl0pKSBCUEdvYWwNCiAgICB3aGVyZSAoDQogICAgICBzaW5nbGV0b24gZnJvbSAoQlBHb2FsLnRhcmdldCBTeXN0b2xpYw0KICAgICAgICB3aGVyZSBTeXN0b2xpYy5tZWFzdXJlIGluICJTeXN0b2xpYyBibG9vZCBwcmVzc3VyZSINCiAgICAgICAgICBhbmQgU3lzdG9saWMuZGV0YWlsIGlzIFF1YW50aXR5DQogICAgICAgICAgYW5kIFdpdGhVbml0KFN5c3RvbGljLmRldGFpbCwgJ21tW0hnXScpKQ0KICAgICkgU3lzdG9saWNUYXJnZXQgaXMgbm90IG51bGwNCiAgICAgIGFuZCAoDQogICAgICAgIHNpbmdsZXRvbiBmcm9tIChCUEdvYWwudGFyZ2V0IERpYXN0b2xpYw0KICAgICAgICAgIHdoZXJlIERpYXN0b2xpYy5tZWFzdXJlIGluICJEaWFzdG9saWMgQmxvb2QgUHJlc3N1cmUiDQogICAgICAgICAgICBhbmQgRGlhc3RvbGljLmRldGFpbCBpcyBRdWFudGl0eQ0KICAgICAgICAgICAgYW5kIFdpdGhVbml0KERpYXN0b2xpYy5kZXRhaWwsICdtbVtIZ10nKSkNCiAgICAgICkgRGlhc3RvbGljVGFyZ2V0IGlzIG5vdCBudWxsDQoNCmRlZmluZSAiTW9zdCBSZWNlbnRseSBFc3RhYmxpc2hlZCBCbG9vZCBQcmVzc3VyZSBHb2FsIjoNCiAgTGFzdCAoDQogICAgIlF1YWxpZnlpbmcgQmxvb2QgUHJlc3N1cmUgR29hbHMiIEJQR29hbA0KICAgICAgc29ydCBieSAoc3RhcnQgYXMgZGF0ZSkNCiAgKQ0KDQpkZWZpbmUgIlBhdGllbnQgaGFzIGEgQlAgR29hbCI6DQogIGV4aXN0cyAiUXVhbGlmeWluZyBCbG9vZCBQcmVzc3VyZSBHb2FscyINCg0KDQpkZWZpbmUgIkJQIGZyb20gTW9zdCBSZWNlbnQgR29hbCI6DQogICJNb3N0IFJlY2VudGx5IEVzdGFibGlzaGVkIEJsb29kIFByZXNzdXJlIEdvYWwiIEJQR29hbA0KICAgIHJldHVybiBUdXBsZSB7DQogICAgICBzeXN0b2xpYzogc2luZ2xldG9uIGZyb20gKEJQR29hbC50YXJnZXQgU3lzdG9saWMgd2hlcmUgU3lzdG9saWMubWVhc3VyZSBpbiAiU3lzdG9saWMgYmxvb2QgcHJlc3N1cmUiKS5kZXRhaWwgYXMgUXVhbnRpdHksDQogICAgICBkaWFzdG9saWM6IHNpbmdsZXRvbiBmcm9tIChCUEdvYWwudGFyZ2V0IERpYXN0b2xpYyB3aGVyZSBEaWFzdG9saWMubWVhc3VyZSBpbiAiRGlhc3RvbGljIEJsb29kIFByZXNzdXJlIikuZGV0YWlsIGFzIFF1YW50aXR5DQogICAgfQ0KDQpkZWZpbmUgIkFib3ZlIEdvYWwgQXZlcmFnZSBNb3N0IFJlY2VudCI6DQogICJBdmVyYWdlIE1vc3QgUmVjZW50IEJQIFNldCIuc3lzdG9saWMgPiAiQlAgZnJvbSBNb3N0IFJlY2VudCBHb2FsIi5zeXN0b2xpYyBvcg0KICAiQXZlcmFnZSBNb3N0IFJlY2VudCBCUCBTZXQiLmRpYXN0b2xpYyA+ICJCUCBmcm9tIE1vc3QgUmVjZW50IEdvYWwiLmRpYXN0b2xpYw0KDQpkZWZpbmUgIkJQIEdvYWwgTWV0IjoNCiAgIlBhdGllbnQgaGFzIGEgQlAgR29hbCIgYW5kICJIYXMgQlAgU2V0IiBhbmQgbm90ICJBYm92ZSBHb2FsIEF2ZXJhZ2UgTW9zdCBSZWNlbnQiDQogIGFuZCBub3QgIkJQIEhpZ2hseSBWYXJpYWJsZSINCg0KZGVmaW5lICJHb2FsIEludGVydmFsIjoNCiAgSW50ZXJ2YWxbKCJNb3N0IFJlY2VudGx5IEVzdGFibGlzaGVkIEJsb29kIFByZXNzdXJlIEdvYWwiLnN0YXJ0IGFzIGRhdGUpLA0KICAgICgiTW9zdCBSZWNlbnRseSBFc3RhYmxpc2hlZCBCbG9vZCBQcmVzc3VyZSBHb2FsIi5zdGFydCBhcyBkYXRlKSArIDMgbW9udGhzXQ0KDQpkZWZpbmUgIlBhdGllbnQgb24gVHJhY2siOg0KICBub3QgIlBhdGllbnQgaGFzIGEgQlAgR29hbCIgb3Igbm90ICJIYXMgQlAgU2V0IiBvciAiQlAgR29hbCBNZXQiIG9yIGVuZCBvZiAiR29hbCBJbnRlcnZhbCIgPiBUb2RheSgpDQoNCmRlZmluZSAiQWN0aXZlIE1lZGljYXRpb24gUmVxdWVzdHMiOg0KICBbIk1lZGljYXRpb25SZXF1ZXN0Il0gUnggd2hlcmUgUnguc3RhdHVzLnZhbHVlIH4gIkFjdGl2ZSBNZWRpY2F0aW9uIFJlcXVlc3QiLmNvZGUNCg0KZGVmaW5lICJNZWRpY2F0aW9uIFJlcXVlc3RzIFdpdGggTWVkaWNhdGlvbiI6DQogICJBY3RpdmUgTWVkaWNhdGlvbiBSZXF1ZXN0cyIgUngNCiAgICBsZXQgbWVkaWNhdGlvbjogc2luZ2xldG9uIGZyb20gKFtNZWRpY2F0aW9uOiBpZCBpbiBMYXN0KFNwbGl0KFJ4Lm1lZGljYXRpb24ucmVmZXJlbmNlLCAnLycpKV0pDQogICAgcmV0dXJuDQogICAgICBNZWRpY2F0aW9uUmVxdWVzdCB7DQogICAgICAgIGlkOiBSeC5pZCwNCiAgICAgICAgc3RhdHVzOiBSeC5zdGF0dXMsDQogICAgICAgIGludGVudDogUnguaW50ZW50LA0KICAgICAgICBjYXRlZ29yeTogUnguY2F0ZWdvcnksDQogICAgICAgIG1lZGljYXRpb246IG1lZGljYXRpb24uY29kZSwNCiAgICAgICAgc3ViamVjdDogUnguc3ViamVjdCwNCiAgICAgICAgYXV0aG9yZWRPbjogUnguYXV0aG9yZWRPbiwNCiAgICAgICAgcmVjb3JkZXI6IFJ4LnJlY29yZGVyLA0KICAgICAgICBkb3NhZ2VJbnN0cnVjdGlvbjogUnguZG9zYWdlSW5zdHJ1Y3Rpb24sDQogICAgICAgIGRpc3BlbnNlUmVxdWVzdDogUnguZGlzcGVuc2VSZXF1ZXN0DQogICAgICB9DQoNCmRlZmluZSAiUGF0aWVudCBpcyBVc2luZyBBbnRpaHlwZXJ0ZW5zaXZlIE1lZGljYXRpb25zIjoNCiAgIk1lZGljYXRpb24gUmVxdWVzdHMgV2l0aCBNZWRpY2F0aW9uIi5tZWRpY2F0aW9uIGluICJBbnRpaHlwZXJ0ZW5zaXZlIE1lZGljYXRpb25zIg0K"
  } ]
}